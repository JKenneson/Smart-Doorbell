[{"id":"b4c0485e.b6783","type":"mqtt in","z":"deb0d57.1c46528","name":"","topic":"KFM","qos":"2","broker":"91f33746.378628","x":103.00004577636719,"y":302.33335876464844,"wires":[["90becc3c.16ec68","42da0616.473c88"]]},{"id":"90becc3c.16ec68","type":"debug","z":"deb0d57.1c46528","name":"","active":true,"console":"false","complete":"payload","x":310.4286308288574,"y":296.3333387374878,"wires":[]},{"id":"cdd1e3f0.9203a8","type":"comment","z":"deb0d57.1c46528","name":"MQTT Receive Data","info":"This work flow receives data from the MSP432 with wifi attachment\n* Receives the data as a csv string\n* Goes into a convert reading function that\n    * parses the values that are comma separated\n    * converts to integers\n    * determines the rough current capacity of the milk jug (half gallon)\n    * creates JSON object and attaches to payload\n* Then payload is passed to another function that:\n    * Takes the readings and attaches a timestamp to them\n    * creates a new payload and returns that msg\n* finally the data is stored in a cloudant DB","x":124.00004577636719,"y":251.33335876464844,"wires":[]},{"id":"2bc0a3ff.c273c4","type":"http in","z":"deb0d57.1c46528","name":"","url":"/","method":"get","upload":false,"swaggerDoc":"","x":121,"y":162,"wires":[["758b93f.990076c"]]},{"id":"ae61889e.d690d8","type":"http response","z":"deb0d57.1c46528","name":"","statusCode":"","headers":{},"x":1020,"y":156,"wires":[]},{"id":"c508049c.b9f34","type":"template","z":"deb0d57.1c46528","name":"Webpage Template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n    <head>\n    {{{payload.css}}}\n    </head>\n    <body>\n        <div class=\"center\">\n        <h1 align=\"center\">Smart Doorbell</h1>\n        <h2 align=\"center\">By: KFM Industries</h2>\n        <h3 align=\"center\">Jon Kenneson, Alexander Furches, & Kyle Monto</h3>\n        <form action=\"/upload\" method=\"POST\" enctype=\"multipart/form-data\"  align=\"center\">\n            <input type=\"file\" name=\"myUploadedFile\"  align=\"center\"/>\n            <input type=\"submit\"  align=\"center\"/>\n        </form>\n        {{{payload.html}}}\n        </div>\n    </body>\n</html>","output":"str","x":846,"y":157,"wires":[["ae61889e.d690d8"]]},{"id":"db4bb1b4.5a7568","type":"comment","z":"deb0d57.1c46528","name":"Get Main Page Request","info":"This flow begins with an HTTP get request for the\nroot of the smart doorbell website, then generates\na template and pushs the html page to the client.","x":129.57142639160156,"y":117.71428680419922,"wires":[]},{"id":"a35d26b0.e3f74","type":"cloudant out","z":"deb0d57.1c46528","name":"","cloudant":"","database":"images","service":"smart-doorbell-kfm-cloudantNoSQLDB","payonly":true,"operation":"insert","x":1730.995979309082,"y":258.3492240905762,"wires":[]},{"id":"758b93f.990076c","type":"function","z":"deb0d57.1c46528","name":"setQueryPayload","func":"// Set the msg to query the database containing the images \n// either uploaded from the Smart doorbell or the upload \n// button on the website\nmsg.url = \"https://f5b8c6ed-103b-4151-b029-70a10968cc4b-bluemix.cloudant.com/images/_find\";\nmsg.headers = {\n    \"Content-type\" : \"application/json\"\n};\nmsg.method = \"POST\";\nmsg.payload = {\n   \"selector\": {\n      \"time_stamp_nano\": {\n         \"$gt\": null\n      }\n   },\n   \"fields\": [\n      \"imageData\",\n      \"time_stamp_nano\",\n      \"faces\"\n   ],\n   \"sort\": [\n      {\n         \"time_stamp_nano\": \"desc\"\n      }\n   ],\n   \"limit\": 3\n};\nreturn msg;","outputs":1,"noerr":0,"x":301,"y":163,"wires":[["3f60bc46.04da54"]]},{"id":"212727ca.bf10a","type":"function","z":"deb0d57.1c46528","name":"setString","func":"// Building of the html for any number of images returned from\n// the database query, along with any number faces detected within\n// those images\nvar i = 0;\nvar html = '<h4 align=\"center\">Displaying ' + msg.payload.docs.length + ' most recent images</h4>';\n// loop for iterating through the images\nfor(i = 0; i < msg.payload.docs.length; i++){\n    var img = msg.payload.docs[i].imageData;\n    //EST\n    offset = -5.0;\n    EST_date = new Date(msg.payload.docs[i].time_stamp_nano + (3600000*offset));\n    var timestamp = EST_date.toLocaleString();\n    msg.payload.css = global.get(\"css\");\n    \n    html = html + '<h5 align=\"center\">Picture Taken at: ' + timestamp +  '</h5>' +  \n                '<p align=\"center\"><img  align=\"center\" src=' + img + '></p>';\n    if(msg.payload.docs[i].faces === \"No Faces Detected\"){\n        html = html + '<p align=\"center\">No Faces Detected</p>';\n    } else {\n        var j = 0;\n        // loop for iterating through the faces in an image\n        for(j = 0; j < msg.payload.docs[i].faces.length; j++){\n            var face = '<p align=\"center\">Face ' + (j+1) + ':</br>Age: between ' + msg.payload.docs[i].faces[j].age.min + \n            ' and ' + msg.payload.docs[i].faces[j].age.max + ' with confidence of ' + msg.payload.docs[i].faces[j].age.score + \n            '</br>Gender: ' + msg.payload.docs[i].faces[j].gender.gender + ' with confidence of ' + msg.payload.docs[i].faces[j].gender.score + '</p>';\n            html = html + face;\n        }\n    }\n    \n    if(i !== msg.payload.docs.length - 1){\n        html = html + '<hr>';\n    }\n}\n\nmsg.payload.html = html;\nreturn msg;","outputs":1,"noerr":0,"x":651,"y":161,"wires":[["d7536093.39c8b8","c508049c.b9f34"]]},{"id":"bd8da248.da6828","type":"function","z":"deb0d57.1c46528","name":"setPathForBuffer","func":"var files = Object.keys(msg.req.files);\nmsg.payload = msg.req.files[files[0]][0].path;\nreturn msg;","outputs":1,"noerr":0,"x":336.92858123779297,"y":1797.0714492797852,"wires":[["5ac6ed7c.9474b4"]]},{"id":"9d36dd8a.1d7fb","type":"function","z":"deb0d57.1c46528","name":"createImagePayload","func":"var files = msg.req.files;\nfilename = files.myUploadedFile[0].originalname;\nvar mime_type = files.myUploadedFile[0].mimetype;\nvar data = Buffer.from(msg.payload).toString('base64');\nvar dt = new Date();\nvar utcDate = dt.toUTCString();\nvar imageDataString = 'data:'+ mime_type +';base64,'+ data +'';\nvar jsobObject = { \n\"time_stamp_string\": utcDate,\n\"time_stamp_nano\": dt.getTime(),\n\"imageData\": imageDataString\n};\nmsg.payload = jsobObject;\nmsg.file = filename;\nreturn msg;\n\n\n","outputs":1,"noerr":0,"x":712.5,"y":1795.5,"wires":[["5dbd96e9.dfe5a"]]},{"id":"65614fc.6cee23","type":"http response","z":"deb0d57.1c46528","name":"","statusCode":"","headers":{},"x":1133.2500114440918,"y":1756.2142534255981,"wires":[]},{"id":"8fb6e50a.7ae81","type":"inject","z":"deb0d57.1c46528","name":"","topic":"","payload":"FFD8FFFE0024AE00CE19000000000000000000000000000000F0004001150032120B510451040000FFDB0084000504040504030505040506060506080D0908070708100B0C0A0D131114141311121215181E1A15161D1712121A241B1D1F20222222141925282521271E212220010606060807080F09090F201612162020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020FFFE0005000000FFC000110800F0014003012100021101031101FFC401A20000010501010101010100000000000000000102030405060708090A0B0100030101010101010101010000000000000102030405060708090A0B100002010303020403050504040000017D01020300041105122131410613516107227114328191A1082342B1C11552D1F02433627282090A161718191A25262728292A3435363738393A434445464748494A535455565758595A636465666768696A737475767778797A838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE1E2E3E4E5E6E7E8E9EAF1F2F3F4F5F6F7F8F9FA1100020102040403040705040400010277000102031104052131061241510761711322328108144291A1B1C109233352F0156272D10A162434E125F11718191A262728292A35363738393A434445464748494A535455565758595A636465666768696A737475767778797A82838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE2E3E4E5E6E7E8E9EAF2F3F4F5F6F7F8F9FAFFDD00040014FFDA000C03010002110311003F00F377848394241F6A66F65389323DF3C5730C520F627DB9A85E53BB6C7967F4ED4580548883BA4259EA4C9F5343D580BB8F3C9A371C75340C5DC7D4D3B71CF24D210E121CF53F9D3839F53400ECEE3D4823A106A449D94857273D8E7AD005A490FA9AB29230C727F3A7A816639DBD4FE756A2BEDA400CC5BD050D5C0D1B7BD9B3CB941E80F35D069DAB340C0A391F8D6725D00F51F08F8F05B95B6D418B5BB1E1BA94FF00EB7B57AA47245736EAF1B24B0C8382395615B5195D72B319AD6E791F8E7C31269327DAEC8B9B190FA92636FEE9F6F43FE4F250D9249043392598F5C9CE2B19C5C5D8D62EEAE6C1908880524607AD67DC177CF2DF9D628A32E689F9E4D674D0B7A9AB405096120F04D529233CF5AA02ABC47D4D40F1373C9A69810B427DEA13130F5AB10C68CFBD46D1B7BD2B0113A6DFBCD803D4D539AF208B399327D0734580CF9B54FF009E487F1354A4BD9DFF008C8F61C5528F70B9FFD0E1DE020D57962001C818AE5194CC6EFBBC9C84F53DFE94B1AAAE540DA7BE7A9A603C8A6914AE313FAD2678A0419E28CD2B8EC2EEA76EA60395AA5072307041A40396431753941DFB8A9D6E81E231BCFB74A044C859BFD6371FDD156924083E5E05340585BADBDEAEDBDDBBB623527DFB5260745A7F99B95A490FD0715EABE11F16BE928B6F28DF684E4A0EABEE2A399C5DD09ABAB1E8F75ABE8779A3C9F6CBCB66B39D4A3248E0139ED8EB9FD6BC676456BE743048D2DB47338824752ACE99E090791575E5176B134EFA92C7223AD0EAA7D2B9CD0A53463D2B3668CFA534C0A12C04F6AA8F6FC9AA4C0AED6D55DEDFDA9810341ED9AAB3186104CAEABF534D316C64CFABDB47911E643EC38AC99F5799F88C041F99AA199D2CF24A7F78EC7F1AAE47B5521119A61AB423FFD1C1B9B3F2FA8FC2B324B3663990617FBBFE35CC044D0E3A5569210C0E40CD2195CABC7FED2FEA28C86190680184629A698C434DEF4AC805FA1A5145C078200EB48262DC46371F5ED45AE172400B732367D874A7EEF2F98FA775A403D6F14E3079F4EF5663134A781B57D4D0068DBDA2EECB12C7D4D6DDB458C62862376D10E062BA0B352319359C80D657541B8E338C66B2B51BBC0CE6A16A323B2BA2EBC735AB1EF7143024301239A81EDB8E94865492D80ED54A4B7C55211937B77696809B89E343E84F3F9573779E27B75245B46D21F53C0AA4AE060DD6B979719018460F6418ACB76776CBB163EA4D5A40444530AE7BD3023602A067507AF3EDCD34046C5BD303FDAE2ABBCA8BC17FC00AB11FFFD2EB355F07CD6EEC648CEE1ED5C85EE90D11395AE352030E7B32A4D67CB07AD55C655788D55920CE4AFCADEA280206250E24FCC74A319145C64641A4C52BA017BD33CC2788C67DFB517017CBDDCCA771F4ED526E0063A53B80DF38670BC9F41D6A54825971B8EC5F41D68B817ADED910F039F5EF5A70C7D31484695BC3C8E2B66DA0E47152DEA06DDB46062B5E1214566D8C95D998719ACFBAB46953D692605BD26C0E391CD745159E074A5263B129B703AD63EA9ABE9BA5A9FB75DC5111FC25B2DF975A4B50386D53E225A2929A6DBBCC7B3BFCA3F2EB5C75FF008AB53BF2D99BCA43FC318DB5AC636118AC5E46DCEC493D49346CAD13B085094853B1A2E046C9D3D2A365ED42195254090349CBB0E7693594D7B212428080FA55AD4440CECE7E66A8CF5A6981FFD3FADAF74BB5BF8CACF1824FF177AF3ED7FC0194792D577AFA0EB5CB529F2FBC8884BA33CAB58F0C4B048C0C6463DAB8FBBD31A36395353168D0C89AD8AE78AA32458ED54C0AAF1E6AB189949F2FF2ED4863410782369F435196DC7F76BBBD4F614009E5EE3990EE3E9DA9776D14790C88B966C2024FB54A96CEFCC8D81E829EC22EC502A7DD502ADC71D4B02E451648AD0821A7D046A41174AD7B78FA543035A08CF1C569C3167B543197E2B6CF6AB26C94A722A2E3209353D2F458CBEA3790C007666E4FD075AE5756F8B7A7C01A3D22D24B971D2497E45FCBA9FD29A8F330381D57C7FAEEAA595AE8C111FF009676FF0027EBD6B98796495CB48CCCC7A963926B651484029E073548192AAD4AB1E7B5021E22F6A634740103275A85978A008C81920F43C5737730F9372E9DB3C554408B1C6693AD581FFFD4FB0E8A0E732354F0FD9EA91B79918573FC405795789BC0925AEE754DC9D88AE4A90E4775B1B4257D0F2CD4F466819814AE6AE2D0AB74A716594248319AA720E4AA0DC7F952B015DADB7F32F27D0700542F9897FBC9FA8A63220CD2FF00AA05B3DFB54A9645B994E7D874A3602D240A800000A9D63A404E91D5A8E3A56117618B26B4608718E28606ADBC3EA2B5ADE11C54319AB0478038AB535E5A69F0996F6E228631CEE9180A8B01CCEA5F1434BB20534E8A4BB907F17DC4FCCF3FA5713AAFC43D7353DCA9702D613C6C8063F5EB571A7D581CAC93C9348CF2BB3B1EACC724D47D7A568900EED48658D5F05D41F4CD160254208041047B54AA726930278D726B6F4ED325BC70B121627B0AA423A46F01EB3E4798BA6DD15C672216C7E78AE5EEEC1ED9CACA3691D8D558465CAA0671551C707350C6577E9F4ACBD4E3DE8B28EDC1A7119959FA521AD16A23FFD5FAF2D6F20BC88496B2AC8BFEC9E9F5A9E9269ABA39DAB0532589268CA4AA194F506869356609D8F3CF16782A296269ED132BD4AE3A578A6B1A335BC8C367E95C8D72BE53A22EEAE7277362771DFF0090ACD962083818C556E3293A3C8711A93EFDA9A2C327329DC7D074A4325F200E83029445408788B8E9532C54016121CF6AB914193D29B02FC307A0AD1821C638A8B8CD18D52352D215551D4938C567DDF8C34AD3F2A921B8947F0C4323F3E94B70398D43E206A5700A5904B58FD546E6FCCD72D737971792992EA692573FC4ED9354A36021FCB14EAA017A0E94BC500387E94E855625C05FA9F5A77158978273C7D2A451480BF6B1177000EF5F5C7803E1FDAF8474D8E5B8026D5A441E6C879119EEA9FE3D4D6908A6CCE6EC7715C37C43F07E8DACF86352BDBBB7860BDB681E65BB4015B2A09C31EE0F4E6B596C445D99F22CF80C471545FF00C8AE77B9B959CD549B0F1BA1E8D490186CBB5886C7151970781F31F6E6B503FFD6F47B0D7AE2CE5568A47461DC1C5777A57C4052153514DE3A7989C1FC4571C66E2C528DCED2C755B2D490359DC2487FBB9C30FC2AED75C64A4AE8C5AB0D7DAC0ABE0823906BC73C69A7C22EE531E3193C0AE7ACD732B1A533CAAFAC1DE46112647AF6AC7974A0B9F37E63E9DAA2F6342AC96C14600AACD0F3548088C5408BDA801EB0F3532419EB4C0B51C357638854360367D52C6C01F3E65DE3F81793F95625E78CDC656C600A3FBF2727F2A490CE7AF355BCBF726EA791C7F773C0FC2A9E79EB5690003CD2E7145C0334B9A0076E14A0D003C3734F53C5004808F4A991B068116E1970475AFA2BC29F1CEC9F4E86DFC530CCB771A8537502865931FC4CB9054FD323E9D2AA32B1128DCEAE4F8C3E118EDFCC5BD9A438CF969036EFD703F5AF1CF889F16AEBC5303E9DA7466CF49246E527324D8E9B88E833D87E66ADCEEB4263169EA7924D30C9E6A9C930AC8D4A924FEF54E4B8154845199A2672C4024D40D701460600F6ABB81FFFD7FA3358F87BA6EA51F9DA5BFD96461B976FCD1B67A7D3EA3F2AF38D67C35AB682C4DCC0C61CF1347F321FC7B7D0E0D734E16D56C44677D199316AD3DAC8191D9187420E2B7ECFE246A968A16498CCBFEDF27F3ACD5F745B4BA971FC7977AB8112A966EDB78C7E3DAA536ED2DBEFBF94CAC79DBDBF1F5ACE5F88D2B1CE6A312B1211401D8015CD5CDA673C552633266B4C1E954DEDB1DAAAE22036FED482DE9DC63D60C1E94AE62B74DD33AA2FAB1C50DDC465DCF88ADA1C8B6432B7AF45AC3BBD6EF2E810D298D3FBB1F028486669393927269B9F7AA18C320CE01C9F619A8A4B90BF79D53EBC9A7602752194156041E78A774A900CFA52834C0703E94A0E29087061EB4FDD400F0DEF4F125022459B18E71528B9C77A6029BD2075AAB2DE7079A2EC0A12DE0E79AA52DE0FEF55D9814A4BBCF43559E666E99A7A81136F6A6F947B934C47FFD06F86BE24EB7E1C902E9B7AE61CFCD049F3C67F03D0FB8C1AF6CF0E7C6AD1F54896DFC4310B29586D69141785BEA3923F51EF5CF19F2A2651E6D8DED53C0DA0F896D4DDE8D3C50B3F2B2DAB07858FD0703F0C7D2BC83C51E13D57C332037D0E6DD9B097119DD1B1F4CF63EC706A670E5D56C38CAFA3DCB7A127970A1039201AE80DC071B4B74AC1DCB28DC00738AC89E20D9C0A680CD96D413D2A9496B93D2A930B159ED40EB59179AA5859643CA2493FBA9C9FF0A6073F77E239E5C8B6410A9EFD5AB1669A599F74AECEDDCB1CD52482C4279E951B48A0E3A9F41C9A632196611E77954FF7B93F955392FA300850CE7D5B81F955240CAEF75348319C2FA2F1517964804FE355B6C22C4124B6C46CE54F2466B56395665CAF07B83D8D449A1D871383CD26E069085DD81C501E8B6802F9832297CD03140079C01A3CF03BD3B6A035AE80A8DAF71DF8A2CC4577BEE7AD577BB63549015DA476EF4DD849E68B80BE4F434EF247A5001E50A431FB53B88FFFD1F34175B7017AF602AF5AB4CEC0B3155F41D6B9521B3B7F0DEBFAA6877025D2AF26B673D76370DFEF0E87F1AF49B8F881ADEBFE1E974BBEFB3F9570BB269562C3BAF71E833EA067D3143935B3172A6558E45B4B42471815058DCC930661DCD6251A3B49196AAD2275E28199B79716D671192EA68E241DDD80AE3753F1ADA445934E89A761C6F6F957FC4FE95515711C85FEB97FA8922698843FC11FCA2B376FAD68924005698E18E026339EFD053195AF4BDAAEE28F2AFAAF0BFE359325FCCF90A446BE89C55248456E49C9EB4F8A269A455405893DB9AA0B16EE445A7978C02F205C96F4F6C5519EF4A2E140C920938C61476FCF1F954AD752F629C97D3993F73F201D075E7D7EB4D175701CA29F9CF2EDFF00D6AAE5448F1AD3DB32AF9824F524E6B6AC2FA3BDB62CB229917AAF4352D2416B963CCC534CB4EC8910CD83FD2A36B8E38A6033ED54C6BA38EBFAD164047E73374CD265DA8D0072C24F5A9561E7A52112AC1ED520B73E945D012AD9BB7DD43522E9B21EA00A5CC8761E9A78232D9269DF6355E8B53CD703FFD2F39B7B5098C0E7DEB62DA0E4572F519D1E9F6BCAF15D869F0100605448668CF6ACF09F7AD0B0B010DB28C62B37B023375AF13693A182B7774A651FF2CA3F99FF002EDF8D79BEB1F11EEAE7747A5C22DE3FF9E8FF00339FE82AE30B85CE2AEAF6E2FA6F32EE69257F576CD300E99AD2D618F0BCD2E3D6980639A611CD08066E2B903A1EA2B3AEAC63989640118FA74A69D80CB9619216C3AF1D88AD54BB1A4E92AC8BFE9371CE7FBA3B512D5587139C7B97964625BEF1CE4D549653BCF3B97AE48E954B406C855DCE5D1B049E4F5351162808504B37DE6AAB1372AC92004851823B9E69B1DD4F6D22346C0107238C53B01D85ADFADED9873849947CCB9E1BDC535AE09E2A396C0466576A3E76143B20B8E54638C9352AC5DFBD022658AA758724714016A2B477E8A7F2ABF0E932BE3200FAD45FB01A96DA017C64337B015AF0F86A5DB94B73F88A4C2E4CDE1FB851CC46AB49A44C9D6334580A26C593702A783503DB11DB9A623FFFD3E421B6E9C56CDA5A9C8E2B906751A759FDDC8AEAED628E08B7CACA88A32598E00ACE4C68C1D6FE2068DA6A18AD09BC9C1E91F080FF00BDFE15E79ACFC40D6755062497EC96E78F2EDFE5C8F76EA69C63D58CE51999D8962493EB4817DAB5403C28F4A91578E9408781CE6942E7EB4D801150B71480859AA167A2C321243305600A9ED59BACDCB5F5C83801170AA00C600E2AADA8E261CCC3CCC0F940E00AA848C607249E954262A8007D2A39188423B9A3762294A0EDF931555F706C64E6B488996F4CBD369748C49DB9AEC195650B322E124E9F5A992D410AB167A0A9561350DD809E3B763C2A93F855B8EC1CE0918A5748372F45A70E37E6AFC3A7A02309CFBD45EE06DD8E9324EE0227E95D9E91E0D69994BA9346C23D1F47F01C676E6303F0AEAA2F0344B17FAB19FA5436067DF783D5633B62E9DF15C86A3E19080FC94D319C85F6861266F97A8AC0BAD2F693F2D5DF411FFFD4CC82CFE61C56C44905A47E65D4891A0EEC702B8D8CA379E3AB5B3529A6C5E7C9D03BF0A0FD3A9AE3B54F10EA3ABC9FE9B72CC9DA35F9507E02851EE3328F5EB4957618A2A4519201A2C074DA27827C41AFDB89F48D22F6E6DCE4099213E59C75C374CFE356355F02F88F44B569F53D16FA0B74FBD33424A2FD58702AB9591CC8E70AE0F3DA90F14AC52227602AB48F8A2C056793AF22AAC9281D6A920644B2862DCF406B36EDC451617EF1F5A2CEE52D8C87CB67038EC6ABBA9031DFDBD2A8912347279E829B2A1DB9E80F6A07A949F28B8FE5558FDD27DEAD12C66E23A75CD761E18B86BBB76B476CB21DCB9F4EFF00D29496823AA8F4F1FC44FE156E3B345C7CB5837728B490631C62ACA41495C0B905AB3B00066BA3D374532B29619A649E87A2682A0A7C82BD2F44D040DA76F150C0EDEDACA381000BCD5BC56F4E092D4C64EEC63C4920C32835CD6ADA3A15242F159D5859DCA83E879F6AFA4289930B82720FF3FE95C7EA1A6609F978A94CD0FFD5E5AEFC56D82B611041FDF7E4FE55CFDCDE4F77217B9959CFFB46B9546C5588339A420B7438FA53B8C3A746247BD3875A0070C0A9000CA549C0231C53BF503E98F047C72D12DFC3961A76BD6B2D9CF670AC225B68C342CAA000700E54F1D0023DEBACBDF8D9E0AB7B23225FCD76C54FEE22B67DC7DBE7007EB5AF3A307077D0F94FC41A95B6A3E23D4AF6C6D12CAD6E6E1A48AD50FCB1293C0FEBE9CF1C5633CE05646C958AB25D004E0D5196F07AD52405392F39E0F3555AE19BA5302C5A2492C5315467650385193FE78AC4BD95A46E7839E73493D4AB69720473DB073522A0C92DCE7D053B82D4BF05BA36063B75A64D640E78ACF98D945199736400E2B364B724E2B48CCCE712136CDFE456DF8555E3F115B0C1F98907F2354E49A32B58F53586A658BD05738C9922F6ABB6F6A5D8714D08E8B4ED3471C5771A4E9BC8C2D0C47A268BA60050E2BBEB2B71144300524AF2B1327645DA2BACC42A1B888491907D2B3A8AF11C5D99C46BB6BC6EFEEB0FE75C5EA56DF7BA5732373FFFD6F2C924485774F22C43FDA3963F80FF00EB567CDAB26EC408CD8FE290FF00203A573A4CB163D5636E2452A7D4722AD25C248328C08F6A1C443B7F1FFD7A5F37A7345804F3C0EF4A2E40EA68B301DF6E0075A636A3C7069F2B19524D4BD0D537D4189E29D845769E473919A6ED763CE6980A20FAD482DC9EDC52B81A66EEEEC618AD34A7F29845E7DC483A924FCA09F618E3EB5CBEA1E6BC8649170EC7E6F7359C6DCD73BAA452A49228C60B49B40393E95AB1E9F70A8090003573691CB4E372EC1032718E714B2A3E7907159BD4DD2B14675E2A834633569932571A610718AE93C39A681A8DA4C173F7C9FF0067038FD4D537A18C958EF562E2A558B3DAB3B199720B6DC46456E59598DC38A7E40757A65883B78AEE34BB40A1462A188EEB4B800038AE9A2FB82AA9FC444F61F4575190535FEE9A99FC2C6B7395D663DD04C3BED35C65EA89230C070C335CA8DCFFD7F199B4790E4C528727B3706B3E582480ED91194D629DCA22FC69CA4A904120FB5501612F5D300B6EFA0C9A9D6EB764B295FAD2B00C6BB1EB50B5E67EE9A02C466E5CF4CD3373B7534C072C458D4F1DB1F4A405A4B263CED381CF4A9EDACFED1308E1F99802C71D80EB4AE05F5D1F03E63F954EBA722FF0FE752DB0D0C2D78F91379519C79CC0BE3D154003FF00423F8D65E976125ECB76BBB2AA38E7F88E7007E559AD3567A12D628669D62FFDA83CC5202F24115D34AC8B8DDC01ED4E7AB32A6AC998F77AD5A5B31C23391DF18ACC6D7E198E07C83A0069C69BB5C1D45B086E51C64106A06C31C8EB549215EE3E2504FCD5E89E19B75FEC85940F98B119A19954D11BEB1E6AD436F9348C4D5B6B7CE302BA2B1B4E4645481D569D005C60575BA7205C52623AAB2936818ADE8650C314276264AE89C1A5AE98C93462150CED88CD4D596962A3B9CD6A2F92D9E95C7CEDBA00A07DCCAFE5C573C4D8FFD0F2E770A2AA4D282086E47A5616299973247BB20006AAFC8BF7896ABB30B8D33E01DA31F4A6191CD1660C029279E94F488E79146C0588ED598E319ABD169F237F0FE749B11A96DA317233927DABA8D37C2125C0CAC271EA6A2EC68DEBCF04496FA15F5C38C08ADE473C7A2935CC78474577D426128C16B691571CFCDC607F9F4A606F5C6852C24E56B3A4B264EAA6930397D7B4ADD2ADD8CED18120EDED593A5AB2EAADB576A649DB8E3A566CEEA72E6A68D8B95546CAA8C9EA45626A321F29B69E6944A6BDD3909D98CC44C428F5AA52C51B1391D3B8AE9499C8C86191E39311392B9E86B4D27C4796A1A04EC316F663285861676270303AD7ABF832CF50874997FB52331167CC71B75031C93F53FCAA64AC88949BD0EB6387DAAF410E7A0ACDEA41B16B0600E2B7ECE2C62908E8AC94022BA2B37C62A40DBB79F6D6A43758EF49817A3BBE39AB2B72A7AFE74D368971B8AD3A81C9AA77138F9B9E0D0E5708C6C739A84C32E6B969DC6E980ECD9FCFFC9A68A3FFD1F169B501C806A93DDB3F6E2B2B0C858BB9E78A411127BD30245B627A0A9D2C59BB62901723D3467E6FD055D8B4F51FC3CFBD4B632FC566063E5AD4B4D3CCAE02AD4EE173BFF0F78615DD4C89927DABD5B4AF0DAAC03118029823A23E1B4781A392256465C32B0C823B8359771E1D8A18F64512220E8AAB802914733A9684307295C86A3A285270B8A0472D79A600195D415618208E08AE297495B5D49DA266F294642939C544CDA8C9ABA2B5E1FDE13DB15CF5E4C37106944EA7F098974893751590FA7B16381C56F1958E69C352D5B69A02FCD4FBEB73F67458FB37F4A69DD8725A373B2F86FA43497F35EDD4595857113760E7AFE38FE75EA69173D2B39BD4E77B96E28B9E95A1043D2A446ADB47D38ADAB54E450236ED70306B5A0900A903422B803BE2ADC77641EB401656F38C66A78EF89C73D2A6C0486F7AD417179953CFEB420306EE72F904D604D2E2EE41EAA0FF003AB407FFD2F0D86C5E4236AB1AB89A5487AAE077CD62D94584D280C6EFD2A74D3957F86A79844CB6633C0A9D2D401D295C64E96C31D2AC25BF4E29017ADECCBB8005765A1E91B9D7E5AA423D6BC3DA4AA2A92B5E87696E890818F4FE740CD2651B7000AC9BD45233DA8690E2EE7377D6E8C0FA76AE5B51B356CE076A4D8CE3B52B255472463009AF2ABA902CB2E3F2ACAA3D8D68ADD9CDDF4B8EF5CFCECAF21E6AA1A1D4DE852936A0E9F8D54F3374C11464935A58CE4CD6B7B663C30E9CD452A00EC319191427AE8392D0F5BF0969DF61F0D5B023E79B3337E3D3F402BA348AA1EE70BD596E28BDAAFC29408D2813915A900191EB401A313806AEC7301802A445A59FBD4A97278A00956E3A9CD3D2E8EE1CF140128BBC6724E2A27BAE0D2033AE6E720F358B712E6E91BD5483FA55203FFFD3B36BF0FA34B30CCA49C7A5739AAF86CD9C8DB01C560D0CC46B4DA70474A6FD9B9A8B002DB8E6A558295809560E6ACC56FB8F4AAB01BBA7588661C57A0E8962ABB7E5A607A269616345E99AE8E3B950801F51FCE914597BA1D8D66DC4C0F7A186C62DCB6E1C77AF15F1F7C64D17C2BAB49A7456D36A1771E56531305446EEBB8E72477C0A718DCA38DD3BE2BAF8BA6BBB4B6D1E4B64484BBCED3EE0B920018DA39393F91AE4F51BB02EA4F7AC66BDFB1BD35689CDDF5D67760F4AC24779EF319F9579AD22B41C990DD4DB58AE79A8A390C4EB2A11BD7A1357D09BEA5BB6D6A55908980E9F785696876AFAEEB505947BBF7EC37B0FE14072CDF90FCC8A4A361CEADE3A9EF3142891AA46BB51400AA3B01D055A44F6ACCE42CC6BEB57235A00BF10ABB1B014202D24B53ACD8A044CB72314E1719A40482E0F4CD3C5C1079A003CFF0098F34C7B838F6A4AC054966C8CD66CF30DF17FBFFD0D5203FFD4F797D3E24B3C6074AF3DF10E9C8C5F02B1299E777FA76C90902B29A0C1E45488688A9E22F4A009521C9AD1B5B6CB0C8A4074FA75A80578AECB4D50817DA8B8CE96DEE36AF5AB66FB1B7E6FE2140C98EA191D6A17BDDDDE901E6BF15BC74DE13F0AE2C6509AAEA04C56E7BC6BFC720FA7007B9F6AF902F209354BDB78A339926936EF63C0CF524D6D1568DCB4B43D2B4BB5B5D034216767C976DF2C84732363A9FE83B5737AA5CE24639AE383E6936CE9B72AB2312E251226E53D7AE2A8C7218A572BDC75AE8466D949A133C859988E69925BBA728E0FB11557E84A16389C866240DA2BDABE1F78664D1B4E3797E856FAF17EEB0E523E0807D093C91EC294F44673D8EF952A745AC8CCB118F5AB49C77A00B2A7156233CF5A62270C06326A4120C75A40234983D7F1A167E40268E80585932339A7F99CF5A4038C98E6A3327CA68405592E1514EE603F1AE7B53D7AC2CD375C5E4084303CB815482C7FFFD5F7692FC3458CD725AB37984FBD62CA38ABF80331E2B027B6C13C5431153CBC014E58FB6290CB3142735AD690FCC0D023A1B20062B7ADA4DB8A065F5BAC2819A47BDC3C632796A0651BEF14E99A6A66F6FE088F652E0B1FA28E4FE55C96A5F13CACBE568D6493311F2C97336DCFD2340D21FC40A76B8EDDCF9DFC49E22BDF136A92DFEAB70659DB200ED1AE490AA3B0158714AD14C1D0F2A735D1CBA58D0E8D355F3A3072707AE4D65DFC9E664935CB18F2B3572B98124CF14BF29C8F435224E8E79E0F706B468CAE46E46E3B5B151104BE33926988F4EF863E1EB7BD967D4EE8A486D240914479C3E33B88FA1E3DF27B0AF59643E6A67DEB39BD4CDEE4EABC74A9941A92499462A65E050048A727AD5957DAB9A0437CD34A66C77A2C02ADC0CE18D23DCC71F2F22A8F738A00A571E2AD22C54FDA7518131DB7826B0AF7E2A6816C4886696E18768909A7663B18377F17E57C8D374991BD0CAD8AC4BAF1FF008B6FF22DD21B553FDD5C9A6A296E1A18D3FF00C247A97FC7EEA97041EA15B03F4A853C2BE61DD70EEEDDCB126AAFD80FFFD6F451A912319AA975721C1E6B028C2B9C1635913A641E2A588A6F17B522C633D2A6C05A863E95A96E98C74A605D9351B4D3A357BEB986052700CAE173F9D61EB1F13749D2E002C09BFB83D162F9507D58FF004CD38C5B2945B3062F8D2A884DE69601078114F9FD48AE27C43F1575CD62665B575B2B6ED1C6031FC491CD6B1A5AEA5A8A4735FF00095EA889F25D00C0603AC48AC3E840C8ACFB9F106AF3AB89753BE757FBC1AE1C83F866AF912E82933296E1110073C9A77DAA28D3739C01DEA8498B69AA4534ACB131DC06791D6AC34ECDC76358CE3ADCD148A13F0FC8AA524BCF029AD7416C426E18753508D41CBE1001E84D5A8A3372B1D8781FC652786A6B866DCF0CA54CB18C73CE3773E99AF75B0F1768FA8416F34774A37E4E0A9E38E6B3AB077BA12D51D244E92C61E365753D083915381E958089071DEA192F2DA0199A78D07FB4E0501633A5F1568F6DFEB3508323B2B67F95665D7C44D2222444F24A7FD8434D26C2C64CFF0012C37167A7CAE7B1638ACF9BC77AEDC716D671C59F5C9A7CA0527D5FC4D7A7E6BB3183D9062ABBE91A95E8FF004BBC9DF3EAE69E81718DE1BB3B3B769EF5D5224FBCF23600FC4D6959E8963244B241E5C91B0C8652083436C46926990463841F95482DE341F2A8A56430DA07414BB09E8BD2988FFFD7DF5B9E7AD3DA7C8EB5CE32B48F915466E54D20202B9A558F91480B31263B566F893C5761E14B18E5BCDD24F364416E9F79F1D4FB0F7A126DD80F11D73C4D71AD5F3DF5EE3CE750A00E02A8E807B5604DA9C8DC06C0F415D49591A5FA22B9BD27866CD21BE4C73D6993705BD8C9E4629DE7C2FC06A00A9711097EE1C9ED542F4B9B68C376383EF4EE4B2A4333C2D95079AD183589D5C79AC651DC3F5FCEA64AE1197297E6963BA4125BB7CA7A8EE2AA181D8E38C5649DB4357AEC54B9408400C3DEA00F02A81B0EE1EA6B549D8CA5B8D8E42662FD015208ADFD17C4173A6A3C51CDB11FD541C7E62A9ABA145D8ECFC3FE3FD4B4D9E488DDACB1CDD1A6F9829F5AEC62D7B5FD4D58DBEA716D1D7C951C573CE096A8B60DA6EB375FF1F3A9DD303E8E45463C23E61CCF24B213D77B1359DEC4DD9661F09DAC67EE0CFBD5E4D02D93A20E3DA95D813AE996E9D107E5532DAC4A385140122C2B9E16A6F2F0385A2E239BF1CDBB1F016AEC57848D5BF275AF32D2752BDD336C96170C80804C6DCA9FC2B58ABC44D9E91E1BF14C7ACCDF64BB84C37610B641CA301D71F9D758B6AADD306B369A6324FB2A81CD3BC845ED4AC07FFFD0B6B729FDF1F9D3FED51E3FD627E62B9C686B5E440732A7E2C2AA4D7B6FB4933C5FF7D0A4047FDA16607CD7508FAB8A51ABE9CBF7AF6DC7FDB41482CC7FFC241A4C632FA85B0FAC82BC7BE22EA31DDF8CEE258E6F31218A38633D9401938FF8131AD296E34ADB9C85ADA7F68F9AEF776F6D144406799F04939202A8C96E9DAAEC7A1D8381B24D4AF49EF6D68517FEFA6AD652B31971747B18705B4B9303BDDEA091FE8A33527D8F445E648F458F1FDED42693F451509B6220921D117FD44FA229C77174FF00CD6ABB4D696DCC3A8696983D61B0763FF8F0A6AF7B0DC460F13C90A951ACDE6DC74B6B748AAA5DF896D6E632B74754BA6EC66B918FE54D45F4423066BD85C9D914AA3DE6CFF4AA73189C8D81C377DC41FE9569344BB3238E792DDF72311EB5ACBA8092DB2A31274C52946E5465D0A6F72896DE5E4BBB39DD90318C76F7EB4B0BDB3C80333A7A6F0197F1EF8A64F52FFF0066466D83C2E8A09C12CC0A1FA376FA1C564CA8D0CCC92750714260D5868908E4122B734ED5A4484AB48C194763D453E838BB33B1D07C757BA6DB1465173193F2C723608FA1FE95D45AFC4ED365216F2D6E6DDBB900381FD7F4AE79D3D6E86CE9F4AD7B4BD6E5F2F4EBD8E49769731E08600632707EA2B752D4B75358B4D6E21E2C453C58A8EA45021E2D5052F9099A00C2F1AC51B78035F5039FB1487F219FE95E0F6928FB144C0F551FCAB7A7B099AFA05E341E20B7707D41AF5E86EFE40CA782294C11652F013C9C1A93CECF43598CFFD1F2F7974D4D4ED2D4A4EFF6A892547121E8D9EDF853F5E161A3E942EDA29241E6052A253DEB049E882E61D86AB65AE6A096BA45AA2B889A494DECFB146080029EE7935D045E15D564884A3C371CD1B0CABC376A430F51915BC684E4AE8CE756317663DF4196009E6F856F8E473B0A360FA75ACED5E5B1D0F4D37575E1DBD882C8A9FBE5555C9CF704F3C543A3340AB41BB5C834CF1269BA8DFD9C7A658ADBBC8E62692750C2376188D87A80D8CFB5735E2D80C1ADC9731AB7D9F50CDC264FDC624F9919F757DCB8FA5382E5364625A6A973A5CAEF6720495D7697DA091CE7827A1F7155EE758D42E0913DE5C38F4321C7E554E29BBB06EC512C4F53C9E69849ABD890F358639A78B961814ADDC2E2FDA011CA8A0B2376A0644CA33D45336FBD02B0D6C63A0A566F2A308BD4F24D1B888BDA9CBD7FC68B858B105CCD6EC5A09191BB953D6B552F6DAFA154D4234F340C09492A0FD71C8FD7E952D752BC86B5B5A3C655160661CE2198EEFF00C7860D2C1A7C4E0848E7471FC4195FF41CD1CCC5627BBB53A7DA40FE639F31F00342C8318EC4F5A6F9EB32890019EE29EE86D1D57802EA387C58AD2BA4686DE41B99B03B1EBF857AA8F176956876CFA95B0FFB6A09AC26AEC4915E7F897E1DB6FBD7E243E91A337F4AC6BFF8C5A4C29FE836D7170C7FBD84150A9BEA3B239BBDF8BF7B3C216DED561723E621B38FA7158B37C4DF104A488E65894F6033FAD68A925B8AE63DE78BF5DBD4B85B8BE90A5C214917B153D46292CDBFD062FF0076B4568A13D59734F9BCBD5EDBFDEFE95EB1A5DD79B68013CAD4480D0DD4E594A9E0D401FFD2F23B97D2ED23D2F57BB9A5CDADBC56FF0020DC81803F7BD3926B17C55E25B0D57408E0827DF28937901703A1C7F3AC6376D1538F2BB339BF0B907509CFFD32FEA2BEB2F0B5B6EF086883730FF428B853EA33FD6BD4C3AF74E0AEECCDB5B1DA49491C1EDCE6BC7BF681F322F0BE8706F66F36F64240E338418E3BF5AD6AAB4198D3779A3C62DE1FB1E9F1459C49212EC54F4EC3F2C575F7257C55E1C99A2D8B773B9942E71B6F40F9D47A09A31B87FB486BCC92EA7ABB2B1E6AED97C904107041E08FAD31C7CDF5AA10CFE7487DE8106051B477A69009B7F2A695C8E0D20131CD201C8C51601AE702897FD6E69D84215C723B52E4114863B3923DE9CBF5A56009381C5428E51810483F5A76116249E4936F98ECD8E7E639ADCD374ECC24DD0C492711C65C26D041F9DC9E801C7D693B21EE63D9DBDCDEDEF9110677E781C74EF5AA3C3D7C71B902FD5C54B7612D4993C3731FF59344BEBCE6AEC1E16596409E79663C6D8D33537D00D88BC110A461E69085070773018A964D034BB390A1224DBF78F240ED51CF72F95915D58DA2412450A420B82AAC571D7A735891E99736B0889D43320E76366AAFA58971204DF0EA706F52A438C82315E93A35CEC93693C1A1AD04747BA9775401FFD3F9AAFF0050BCD3741BBB2942B437584F9C67F11F975AE53C99A19079B1BA77F9811446C826EECE8FC2E717174D9E91019FC6BEBFF0DBEDF0B68AA983B6C6004023AEC15E8E1ADCA70623737519F667675AF25F8E767F6BD1B4B9A375F334F125C184FDE60CD1C7B80F419CD6988B2A6D995057A88F05B86F2E5C7658F14CD2B538ED12EE1BA577B5BB40AFB0E19181CA48BFED29FD091DEBCB68F5CB3A95849A940D711ED7BF09E6318C7CB7718FF968BFED0FE25FC6B98762C14F6A16A48D34EC1F4AAD8439627738442C7D00CD5C8746D4AE71F67B0B971D888891FCAA5B4B702CFF00C231AB632F68538FF968EA9FCCD21F0E5D2FFAE9ECA2EBF7EE57FA66973A1D98A9A043D67D5F4F4C7656673F905AB7FF0008FD92C5B85DDECFC6730D83EDFCC9A4E7E41630752B35B575D82611B6483347B09FF3C55A7D362671FB8BD24A8C8D80738E79ABBE82EA5A8F488E4578C58DE8931F2E5D01CE3D0D662E933BE441245291C15571B87D41A9B858866B2B9B63FBF85D07A9538FCEA0563BBFC29AB3015F907D2A23D6A908D4D3554069C940C8701A41954F7F73E828BCD444D198A107CB2E19A46E5E423B93FD3B54BDC7B1269970D65AE6F5009D8D807DD6B4A6D7672DC28149AD4488A2D42EEE678E259029918283D866BB585E3D2E259313E13397C0CC9EFCF4ACE6BA17120BBD71DD0C5196D921C8627A7B11555AE926462768C1EB927231D2A52B22BA99D34CCA59C36541E109383508BC7597703B8B0F5395AA489B9622BC13CABF688C39272739257DC5749A6DDA3B8313671D7DA8B0A5DCEC2297CC894FB54A1EA0947FFFD4F94229DB50B5FB2DC367CBF9918F6F6AF41D7A6B197C3FAD4D05F095A5846C859810A772F4E339A89C5DD24166D5D1C5F8724891EE0CF2AC21D0056604827D38FAD7D1FA478FF423A5585B25EA868ADE38DB31F755038E3DABD0A13515667255A739BD11B6DE2FD2EDF4DB8BCFB64722C11B49E58182F8FE10477278FC6BCB2D35D7F1458EA179A94C82EE18F528E3DCD91223DB870832780AD1AE3F0EE69E214AA24A09B1E1E9BA6DB9AB1E537B700CE0020E5477CF6ACD0FF230E2B92C76366A68FACADADACB657618DB48DB9244FBF6F20E8E87F423B8AD78F4D875199A592D8DCCCC158BC13243138E00383CE4F71EB50D35AA04AFB17C6936968031B4D190800FFA45EBC87F10BC533EDF6565855BED26265FF9F6D3CC87F36ACF729C5ADD11B7896D901FF89AEA721C7FCB08638455297C416073BA2D4EE4E3A4F7A40FC94557B36FA0AEBB945F5CB4CE63D1EDB3EB2C8F213F99A8D75F74CF95A7E9A9E98B707F9E69FB362BA1FF00F094EA8BFEA268E107FE78C28BFC8552B8D6B52BA63E7DFDCB96EA0CA71F9552A690B9BB19D34D24CDB6576703FBCC4E298F75337595F19E858F14EC89BB1A24667E49FAD5B4D402B289EDE19940032CB86C7D452E5E887CDDCBB16A96E06145CDB9FF00624DEBF91A995E1B83C3D9CE73D248CC4DF98A9B587B91DD59DB26D32C6F6C5BA32B8953F4E45645CDBB5BCBB58860790CA7208AA8A7D44F42332BBA2C658EC5E83B52672C0555857341081A945E9B481FAD4EE06EEA2A64810A92FD9DD250395606BA596FCCB3BC9334830A1412C1803EF59CA0DEA5C5EB62BA5E3CE4FDA1B71507952338A6C7708214209F29B248C8A3958D8CB87531205279391C8ACF123962D9F9B20751F953E5EE224F3972D821581033BAAFD86A5F6794C830180C15A5CAC0F45D3AFA192DD4F9B1805770CB0E957C5CC27A4B1FD378A97097625465D8FFFFFFFFD9","payloadType":"str","repeat":"","crontab":"","once":false,"x":81.85715866088867,"y":1753.53564453125,"wires":[["edbd2210.c2cd98"]]},{"id":"7e7c5dd.6f2a024","type":"function","z":"deb0d57.1c46528","name":"hexToBase64","func":"// Convert the hex binary buffer to a base 64 image\n// and construct the remaining fields that will eventually end up in the \n// database\nvar buf = Buffer.from(msg.payload, 'hex');\nvar data = Buffer.from(msg.payload).toString('base64')\nvar dt = new Date();\nvar utcDate = dt.toUTCString();\nvar imageDataString = 'data:image/jpeg;base64,'+ data +'';\nvar jsonObject = { \n\"time_stamp_string\": utcDate,\n\"time_stamp_nano\": dt.getTime(),\n\"imageData\": imageDataString\n};\nmsg.topic = \"ImageData\";\nmsg.payload = jsonObject;\nmsg.file = \"TestImage\";\nreturn msg;\n","outputs":1,"noerr":0,"x":759.7857704162598,"y":307.76188373565674,"wires":[["63d3cc7.f413f34","ee167c83.ed53f"]]},{"id":"edbd2210.c2cd98","type":"function","z":"deb0d57.1c46528","name":"stringInBuffer","func":"var buf = Buffer.from(msg.payload, 'hex');\nmsg.payload = buf;\nreturn msg;","outputs":1,"noerr":0,"x":241.60716247558594,"y":1752.5356454849243,"wires":[[]]},{"id":"42da0616.473c88","type":"function","z":"deb0d57.1c46528","name":"buildImage","func":"// Method for iteratively building the image sent to the server \n// checks for starting hex values that represent the file as a \n// jpeg image, checks for terminating string \"KFM\" to know that \n// transmission is complete, and checks to see if current packet\n// is duplicate of the last packet recieved\nvar camData = msg.payload.toUpperCase();\nif(camData.startsWith(\"FFD8\")){\n    global.set(\"finished\", false);\n    global.set(\"currentImage\", camData);\n    global.set(\"lastPacket\", camData);\n} else if(camData === \"KFM\"){\n    global.set(\"finished\", true);\n} else {\n    var lastPac = global.get(\"lastPacket\");\n    if(lastPac !== camData){\n        var partialImage = global.get(\"currentImage\");\n        partialImage = partialImage + camData;\n        global.set(\"currentImage\", partialImage);\n    }\n}\nmsg.payload = global.get(\"currentImage\");\nreturn msg;","outputs":1,"noerr":0,"x":315.0000457763672,"y":347.33335876464844,"wires":[["40df9be0.ea9ac4","b5459102.b25d78"]]},{"id":"8efcdf9e.876148","type":"inject","z":"deb0d57.1c46528","name":"ImageStart","topic":"","payload":"FFD8FFFE0024AE00CE19000000000000000000000000000000F0004001150032120B510451040000FFDB0084000504040504030505040506060506080D0908070708100B0C0A0D131114141311121215181E1A15161D1712121A241B1D1F20222222141925282521271E212220010606060807080F09090F201612162020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020FFFE0005000000FFC000110800F0014003012100021101031101FFC401A20000010501010101010100000000000000000102030405060708090A0B0100030101010101010101010000000000000102030405060708090A0B100002010303020403050504040000017D01020300041105122131410613516107227114328191A1082342B1C11552D1F02433627282090A161718191A25262728292A3435363738393A434445464748494A535455565758595A636465666768696A737475767778797A838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE1E2E3E4E5E6E7E8E9EAF1F2F3F4F5F6F7F8F9FA1100020102040403040705040400010277000102031104052131061241510761711322328108144291A1B1C109233352F0156272D10A162434E125F11718191A262728292A35363738393A434445464748494A535455565758595A636465666768696A737475767778797A82838485868788898A92939495969798999AA2A3A4A5A6A7A8A9AAB2B3B4B5B6B7B8B9BAC2C3C4C5C6C7C8C9CAD2D3D4D5D6D7D8D9DAE2E3E4E5E6E7E8E9EAF2F3F4F5F6F7F8F9FAFFDD00040014FFDA000C03010002110311003F00F377848394241F6A66F65389323DF3C5730C520F627DB9A85E53BB6C7967F4ED4580548883BA4259EA4C9F5343D580BB8F3C9A371C75340C5DC7D4D3B71CF24D210E121CF53F9D3839F53400ECEE3D4823A106A449D94857273D8E7AD005A490FA9AB29230C727F3A7A816639DBD4FE756A2BEDA400CC5BD050D5C0D1B7BD9B3CB941E80F35D069DAB340C0A391F8D6725D00F51F08F8F05B95B6D418B5BB1E1BA94FF00EB7B57AA47245736EAF1B24B0C8382395615B5195D72B319AD6E791F8E7C31269327DAEC8B9B190FA92636FEE9F6F43FE4F250D9249043392598F5C9CE2B19C5C5D8D62EEAE6C1908880524607AD67DC177CF2DF9D628A32E689F9E4D674D0B7A9AB405096120F04D529233CF5AA02ABC47D4D40F1373C9A69810B427DEA13130F5AB10C68CFBD46D1B7BD2B0113A6DFBCD803D4D539AF208B399327D0734580CF9B54FF009E487F1354A4BD9DFF008C8F61C5528F70B9FFD0E1DE020D57962001C818AE5194CC6EFBBC9C84F53DFE94B1AAAE540DA7BE7A9A603C8A6914AE313FAD2678A0419E28CD2B8EC2EEA76EA60395AA5072307041A40396431753941DFB8A9D6E81E231BCFB74A044C859BFD6371FDD156924083E5E05340585BADBDEAEDBDDBBB623527DFB5260745A7F99B95A490FD0715EABE11F16BE928B6F28DF684E4A0EABEE2A399C5DD09ABAB1E8F75ABE8779A3C9F6CBCB66B39D4A3248E0139ED8EB9FD6BC676456BE743048D2DB47338824752ACE99E090791575E5176B134EFA92C7223AD0EAA7D2B9CD0A53463D2B3668CFA534C0A12C04F6AA8F6FC9AA4C0AED6D55DEDFDA9810341ED9AAB3186104CAEABF534D316C64CFABDB47911E643EC38AC99F5799F88C041F99AA199D2CF24A7F78EC7F1AAE47B5521119A61AB423FFD1C1B9B3F2FA8FC2B324B3663990617FBBFE35CC044D0E3A5569210C0E40CD2195CABC7FED2FEA28C86190680184629A698C434DEF4AC805FA1A5145C078200EB48262DC46371F5ED45AE172400B732367D874A7EEF2F98FA775A403D6F14E3079F4EF5663134A781B57D4D0068DBDA2EECB12C7D4D6DDB458C62862376D10E062BA0B352319359C80D657541B8E338C66B2B51BBC0CE6A16A323B2BA2EBC735AB1EF7143024301239A81EDB8E94865492D80ED54A4B7C55211937B77696809B89E343E84F3F9573779E27B75245B46D21F53C0AA4AE060DD6B979719018460F6418ACB76776CBB163EA4D5A40444530AE7BD3023602A067507AF3EDCD34046C5BD303FDAE2ABBCA8BC17FC00AB11FFFD2EB355F07CD6EEC648CEE1ED5C85EE90D11395AE352030E7B32A4D67CB07AD55C655788D55920CE4AFCADEA280206250E24FCC74A319145C64641A4C52BA017BD33CC2788C67DFB517017CBDDCCA771F4ED526E0063A53B80DF38670BC9F41D6A54825971B8EC5F41D68B817ADED910F039F5EF5A70C7D31484695BC3C8E2B66DA0E47152DEA06DDB46062B5E1214566D8C95D998719ACFBAB46953D692605BD26C0E391CD745159E074A5263B129B703AD63EA9ABE9BA5A9FB75DC5111FC25B2DF975A4B50386D53E225A2929A6DBBCC7B3BFCA3F2EB5C75FF008AB53BF2D99BCA43FC318DB5AC636118AC5E46DCEC493D49346CAD13B085094853B1A2E046C9D3D2A365ED42195254090349CBB0E7693594D7B212428080FA55AD4440CECE7E66A8CF5A6981FFD3FADAF74BB5BF8CACF1824FF177AF3ED7FC0194792D577AFA0EB5CB529F2FBC8884BA33CAB58F0C4B048C0C6463DAB8FBBD31A36395353168D0C89AD8AE78AA32458ED54C0AAF1E6AB189949F2FF2ED4863410782369F435196DC7F76BBBD4F614009E5EE3990EE3E9DA9776D14790C88B966C2024FB54A96CEFCC8D81E829EC22EC502A7DD502ADC71D4B02E451648AD0821A7D046A41174AD7B78FA543035A08CF1C569C3167B543197E2B6CF6AB26C94A722A2E3209353D2F458CBEA3790C007666E4FD075AE5756F8B7A7C01A3D22D24B971D2497E45FCBA9FD29A8F330381D57C7FAEEAA595AE8C111FF009676FF0027EBD6B98796495CB48CCCC7A963926B651484029E073548192AAD4AB1E7B5021E22F6A634740103275A85978A008C81920F43C5737730F9372E9DB3C554408B1C6693AD581FFFD4FB0E8A0E732354F0FD9EA91B79918573FC405795789BC0925AEE754DC9D88AE4A90E4775B1B4257D0F2CD4F466819814AE6AE2D0AB74A716594248319AA720E4AA0DC7F952B015DADB7F32F27D0700542F9897FBC9FA8A63220CD2FF00AA05B3DFB54A9645B994E7D874A3602D240A800000A9D63A404E91D5A8E3A56117618B26B4608718E28606ADBC3EA2B5ADE11C54319AB0478038AB535E5A69F0996F6E228631CEE9180A8B01CCEA5F1434BB20534E8A4BB907F17DC4FCCF3FA5713AAFC43D7353DCA9702D613C6C8063F5EB571A7D581CAC93C9348CF2BB3B1EACC724D47D7A568900EED48658D5F05D41F4CD160254208041047B54AA726930278D726B6F4ED325BC70B121627B0AA423A46F01EB3E4798BA6DD15C672216C7E78AE5EEEC1ED9CACA3691D8D558465CAA0671551C707350C6577E9F4ACBD4E3DE8B28EDC1A7119959FA521AD16A23FFD5FAF2D6F20BC88496B2AC8BFEC9E9F5A9E9269ABA39DAB0532589268CA4AA194F506869356609D8F3CF16782A296269ED132BD4AE3A578A6B1A335BC8C367E95C8D72BE53A22EEAE7277362771DFF0090ACD962083818C556E3293A3C8711A93EFDA9A2C327329DC7D074A4325F200E83029445408788B8E9532C54016121CF6AB914193D29B02FC307A0AD1821C638A8B8CD18D52352D215551D4938C567DDF8C34AD3F2A921B8947F0C4323F3E94B70398D43E206A5700A5904B58FD546E6FCCD72D737971792992EA692573FC4ED9354A36021FCB14EAA017A0E94BC500387E94E855625C05FA9F5A77158978273C7D2A451480BF6B1177000EF5F5C7803E1FDAF8474D8E5B8026D5A441E6C879119EEA9FE3D4D6908A6CCE6EC7715C37C43F07E8DACF86352BDBBB7860BDB681E65BB4015B2A09C31EE0F4E6B596C445D99F22CF80C471545FF00C8AE77B9B959CD549B0F1BA1E8D490186CBB5886C7151970781F31F6E6B503FFD6F47B0D7AE2CE5568A47461DC1C5777A57C4052153514DE3A7989C1FC4571C66E2C528DCED2C755B2D490359DC2487FBB9C30FC2AED75C64A4AE8C5AB0D7DAC0ABE0823906BC73C69A7C22EE531E3193C0AE7ACD732B1A533CAAFAC1DE46112647AF6AC7974A0B9F37E63E9DAA2F6342AC96C14600AACD0F3548088C5408BDA801EB0F3532419EB4C0B51C357638854360367D52C6C01F3E65DE3F81793F95625E78CDC656C600A3FBF2727F2A490CE7AF355BCBF726EA791C7F773C0FC2A9E79EB5690003CD2E7145C0334B9A0076E14A0D003C3734F53C5004808F4A991B068116E1970475AFA2BC29F1CEC9F4E86DFC530CCB771A8537502865931FC4CB9054FD323E9D2AA32B1128DCEAE4F8C3E118EDFCC5BD9A438CF969036EFD703F5AF1CF889F16AEBC5303E9DA7466CF49246E527324D8E9B88E833D87E66ADCEEB4263169EA7924D30C9E6A9C930AC8D4A924FEF54E4B8154845199A2672C4024D40D701460600F6ABB81FFFD7FA3358F87BA6EA51F9DA5BFD96461B976FCD1B67A7D3EA3F2AF38D67C35AB682C4DCC0C61CF1347F321FC7B7D0E0D734E16D56C44677D199316AD3DAC8191D9187420E2B7ECFE246A968A16498CCBFEDF27F3ACD5F745B4BA971FC7977AB8112A966EDB78C7E3DAA536ED2DBEFBF94CAC79DBDBF1F5ACE5F88D2B1CE6A312B1211401D8015CD5CDA673C552633266B4C1E954DEDB1DAAAE22036FED482DE9DC63D60C1E94AE62B74DD33AA2FAB1C50DDC465DCF88ADA1C8B6432B7AF45AC3BBD6EF2E810D298D3FBB1F028486669393927269B9F7AA18C320CE01C9F619A8A4B90BF79D53EBC9A7602752194156041E78A774A900CFA52834C0703E94A0E29087061EB4FDD400F0DEF4F125022459B18E71528B9C77A6029BD2075AAB2DE7079A2EC0A12DE0E79AA52DE0FEF55D9814A4BBCF43559E666E99A7A81136F6A6F947B934C47FFD06F86BE24EB7E1C902E9B7AE61CFCD049F3C67F03D0FB8C1AF6CF0E7C6AD1F54896DFC4310B29586D69141785BEA3923F51EF5CF19F2A2651E6D8DED53C0DA0F896D4DDE8D3C50B3F2B2DAB07858FD0703F0C7D2BC83C51E13D57C332037D0E6DD9B097119DD1B1F4CF63EC706A670E5D56C38CAFA3DCB7A127970A1039201AE80DC071B4B74AC1DCB28DC00738AC89E20D9C0A680CD96D413D2A9496B93D2A930B159ED40EB59179AA5859643CA2493FBA9C9FF0A6073F77E239E5C8B6410A9EFD5AB1669A599F74AECEDDCB1CD52482C4279E951B48A0E3A9F41C9A632196611E77954FF7B93F955392FA300850CE7D5B81F955240CAEF75348319C2FA2F1517964804FE355B6C22C4124B6C46CE54F2466B56395665CAF07B83D8D449A1D871383CD26E069085DD81C501E8B6802F9832297CD03140079C01A3CF03BD3B6A035AE80A8DAF71DF8A2CC4577BEE7AD577BB63549015DA476EF4DD849E68B80BE4F434EF247A5001E50A431FB53B88FFFD1F34175B7017AF602AF5AB4CEC0B3155F41D6B9521B3B7F0DEBFAA6877025D2AF26B673D76370DFEF0E87F1AF49B8F881ADEBFE1E974BBEFB3F9570BB269562C3BAF71E833EA067D3143935B3172A6558E45B4B42471815058DCC930661DCD6251A3B49196AAD2275E28199B79716D671192EA68E241DDD80AE3753F1ADA445934E89A761C6F6F957FC4FE95515711C85FEB97FA8922698843FC11FCA2B376FAD68924005698E18E026339EFD053195AF4BDAAEE28F2AFAAF0BFE359325FCCF90A446BE89C55248456E49C9EB4F8A269A455405893DB9AA0B16EE445A7978C02F205C96F4F6C5519EF4A2E140C920938C61476FCF1F954AD752F629C97D3993F73F201D075E7D7EB4D175701CA29F9CF2EDFF00D6AAE5448F1AD3DB32AF9824F524E6B6AC2FA3BDB62CB229917AAF4352D2416B963CCC534CB4EC8910CD83FD2A36B8E38A6033ED54C6BA38EBFAD164047E73374CD265DA8D0072C24F5A9561E7A52112AC1ED520B73E945D012AD9BB7DD43522E9B21EA00A5CC8761E9A78232D9269DF6355E8B53CD703FFD2F39B7B5098C0E7DEB62DA0E4572F519D1E9F6BCAF15D869F0100605448668CF6ACF09F7AD0B0B010DB28C62B37B023375AF13693A182B7774A651FF2CA3F99FF002EDF8D79BEB1F11EEAE7747A5C22DE3FF9E8FF00339FE82AE30B85CE2AEAF6E2FA6F32EE69257F576CD300E99AD2D618F0BCD2E3D6980639A611CD08066E2B903A1EA2B3AEAC63989640118FA74A69D80CB9619216C3AF1D88AD54BB1A4E92AC8BFE9371CE7FBA3B512D5587139C7B97964625BEF1CE4D549653BCF3B97AE48E954B406C855DCE5D1B049E4F5351162808504B37DE6AAB1372AC92004851823B9E69B1DD4F6D22346C0107238C53B01D85ADFADED9873849947CCB9E1BDC535AE09E2A396C0466576A3E76143B20B8E54638C9352AC5DFBD022658AA758724714016A2B477E8A7F2ABF0E932BE3200FAD45FB01A96DA017C64337B015AF0F86A5DB94B73F88A4C2E4CDE1FB851CC46AB49A44C9D6334580A26C593702A783503DB11DB9A623FFFD3E421B6E9C56CDA5A9C8E2B906751A759FDDC8AEAED628E08B7CACA88A32598E00ACE4C68C1D6FE2068DA6A18AD09BC9C1E91F080FF00BDFE15E79ACFC40D6755062497EC96E78F2EDFE5C8F76EA69C63D58CE51999D8962493EB4817DAB5403C28F4A91578E9408781CE6942E7EB4D801150B71480859AA167A2C321243305600A9ED59BACDCB5F5C83801170AA00C600E2AADA8E261CCC3CCC0F940E00AA848C607249E954262A8007D2A39188423B9A3762294A0EDF931555F706C64E6B488996F4CBD369748C49DB9AEC195650B322E124E9F5A992D410AB167A0A9561350DD809E3B763C2A93F855B8EC1CE0918A5748372F45A70E37E6AFC3A7A02309CFBD45EE06DD8E9324EE0227E95D9E91E0D69994BA9346C23D1F47F01C676E6303F0AEAA2F0344B17FAB19FA5436067DF783D5633B62E9DF15C86A3E19080FC94D319C85F6861266F97A8AC0BAD2F693F2D5DF411FFFD4CC82CFE61C56C44905A47E65D4891A0EEC702B8D8CA379E3AB5B3529A6C5E7C9D03BF0A0FD3A9AE3B54F10EA3ABC9FE9B72CC9DA35F9507E02851EE3328F5EB4957618A2A4519201A2C074DA27827C41AFDB89F48D22F6E6DCE4099213E59C75C374CFE356355F02F88F44B569F53D16FA0B74FBD33424A2FD58702AB9591CC8E70AE0F3DA90F14AC52227602AB48F8A2C056793AF22AAC9281D6A920644B2862DCF406B36EDC451617EF1F5A2CEE52D8C87CB67038EC6ABBA9031DFDBD2A8912347279E829B2A1DB9E80F6A07A949F28B8FE5558FDD27DEAD12C66E23A75CD761E18B86BBB76B476CB21DCB9F4EFF00D29496823AA8F4F1FC44FE156E3B345C7CB5837728B490631C62ACA41495C0B905AB3B00066BA3D374532B29619A649E87A2682A0A7C82BD2F44D040DA76F150C0EDEDACA381000BCD5BC56F4E092D4C64EEC63C4920C32835CD6ADA3A15242F159D5859DCA83E879F6AFA4289930B82720FF3FE95C7EA1A6609F978A94CD0FFD5E5AEFC56D82B611041FDF7E4FE55CFDCDE4F77217B9959CFFB46B9546C5588339A420B7438FA53B8C3A746247BD3875A0070C0A9000CA549C0231C53BF503E98F047C72D12DFC3961A76BD6B2D9CF670AC225B68C342CAA000700E54F1D0023DEBACBDF8D9E0AB7B23225FCD76C54FEE22B67DC7DBE7007EB5AF3A307077D0F94FC41A95B6A3E23D4AF6C6D12CAD6E6E1A48AD50FCB1293C0FEBE9CF1C5633CE05646C958AB25D004E0D5196F07AD52405392F39E0F3555AE19BA5302C5A2492C5315467650385193FE78AC4BD95A46E7839E73493D4AB69720473DB073522A0C92DCE7D053B82D4BF05BA36063B75A64D640E78ACF98D945199736400E2B364B724E2B48CCCE712136CDFE456DF8555E3F115B0C1F98907F2354E49A32B58F53586A658BD05738C9922F6ABB6F6A5D8714D08E8B4ED3471C5771A4E9BC8C2D0C47A268BA60050E2BBEB2B71144300524AF2B1327645DA2BACC42A1B888491907D2B3A8AF11C5D99C46BB6BC6EFEEB0FE75C5EA56DF7BA5732373FFFD6F2C924485774F22C43FDA3963F80FF00EB567CDAB26EC408CD8FE290FF00203A573A4CB163D5636E2452A7D4722AD25C248328C08F6A1C443B7F1FFD7A5F37A7345804F3C0EF4A2E40EA68B301DF6E0075A636A3C7069F2B19524D4BD0D537D4189E29D845769E473919A6ED763CE6980A20FAD482DC9EDC52B81A66EEEEC618AD34A7F29845E7DC483A924FCA09F618E3EB5CBEA1E6BC8649170EC7E6F7359C6DCD73BAA452A49228C60B49B40393E95AB1E9F70A8090003573691CB4E372EC1032718E714B2A3E7907159BD4DD2B14675E2A834633569932571A610718AE93C39A681A8DA4C173F7C9FF0067038FD4D537A18C958EF562E2A558B3DAB3B199720B6DC46456E59598DC38A7E40757A65883B78AEE34BB40A1462A188EEB4B800038AE9A2FB82AA9FC444F61F4575190535FEE9A99FC2C6B7395D663DD04C3BED35C65EA89230C070C335CA8DCFFD7F199B4790E4C528727B3706B3E582480ED91194D629DCA22FC69CA4A904120FB5501612F5D300B6EFA0C9A9D6EB764B295FAD2B00C6BB1EB50B5E67EE9A02C466E5CF4CD3373B7534C072C458D4F1DB1F4A405A4B263CED381CF4A9EDACFED1308E1F99802C71D80EB4AE05F5D1F03E63F954EBA722FF0FE752DB0D0C2D78F91379519C79CC0BE3D154003FF00423F8D65E976125ECB76BBB2AA38E7F88E7007E559AD3567A12D628669D62FFDA83CC5202F24115D34AC8B8DDC01ED4E7AB32A6AC998F77AD5A5B31C23391DF18ACC6D7E198E07C83A0069C69BB5C1D45B086E51C64106A06C31C8EB549215EE3E2504FCD5E89E19B75FEC85940F98B119A19954D11BEB1E6AD436F9348C4D5B6B7CE302BA2B1B4E4645481D569D005C60575BA7205C52623AAB2936818ADE8650C314276264AE89C1A5AE98C93462150CED88CD4D596962A3B9CD6A2F92D9E95C7CEDBA00A07DCCAFE5C573C4D8FFD0F2E770A2AA4D282086E47A5616299973247BB20006AAFC8BF7896ABB30B8D33E01DA31F4A6191CD1660C029279E94F488E79146C0588ED598E319ABD169F237F0FE749B11A96DA317233927DABA8D37C2125C0CAC271EA6A2EC68DEBCF04496FA15F5C38C08ADE473C7A2935CC78474577D426128C16B691571CFCDC607F9F4A606F5C6852C24E56B3A4B264EAA6930397D7B4ADD2ADD8CED18120EDED593A5AB2EAADB576A649DB8E3A566CEEA72E6A68D8B95546CAA8C9EA45626A321F29B69E6944A6BDD3909D98CC44C428F5AA52C51B1391D3B8AE9499C8C86191E39311392B9E86B4D27C4796A1A04EC316F663285861676270303AD7ABF832CF50874997FB52331167CC71B75031C93F53FCAA64AC88949BD0EB6387DAAF410E7A0ACDEA41B16B0600E2B7ECE2C62908E8AC94022BA2B37C62A40DBB79F6D6A43758EF49817A3BBE39AB2B72A7AFE74D368971B8AD3A81C9AA77138F9B9E0D0E5708C6C739A84C32E6B969DC6E980ECD9FCFFC9A68A3FFD1F169B501C806A93DDB3F6E2B2B0C858BB9E78A411127BD30245B627A0A9D2C59BB62901723D3467E6FD055D8B4F51FC3CFBD4B632FC566063E5AD4B4D3CCAE02AD4EE173BFF0F78615DD4C89927DABD5B4AF0DAAC03118029823A23E1B4781A392256465C32B0C823B8359771E1D8A18F64512220E8AAB802914733A9684307295C86A3A285270B8A0472D79A600195D415618208E08AE297495B5D49DA266F294642939C544CDA8C9ABA2B5E1FDE13DB15CF5E4C37106944EA7F098974893751590FA7B16381C56F1958E69C352D5B69A02FCD4FBEB73F67458FB37F4A69DD8725A373B2F86FA43497F35EDD4595857113760E7AFE38FE75EA69173D2B39BD4E77B96E28B9E95A1043D2A446ADB47D38ADAB54E450236ED70306B5A0900A903422B803BE2ADC77641EB401656F38C66A78EF89C73D2A6C0486F7AD417179953CFEB420306EE72F904D604D2E2EE41EAA0FF003AB407FFD2F0D86C5E4236AB1AB89A5487AAE077CD62D94584D280C6EFD2A74D3957F86A79844CB6633C0A9D2D401D295C64E96C31D2AC25BF4E29017ADECCBB8005765A1E91B9D7E5AA423D6BC3DA4AA2A92B5E87696E890818F4FE740CD2651B7000AC9BD45233DA8690E2EE7377D6E8C0FA76AE5B51B356CE076A4D8CE3B52B255472463009AF2ABA902CB2E3F2ACAA3D8D68ADD9CDDF4B8EF5CFCECAF21E6AA1A1D4DE852936A0E9F8D54F3374C11464935A58CE4CD6B7B663C30E9CD452A00EC319191427AE8392D0F5BF0969DF61F0D5B023E79B3337E3D3F402BA348AA1EE70BD596E28BDAAFC29408D2813915A900191EB401A313806AEC7301802A445A59FBD4A97278A00956E3A9CD3D2E8EE1CF140128BBC6724E2A27BAE0D2033AE6E720F358B712E6E91BD5483FA55203FFFD3B36BF0FA34B30CCA49C7A5739AAF86CD9C8DB01C560D0CC46B4DA70474A6FD9B9A8B002DB8E6A558295809560E6ACC56FB8F4AAB01BBA7588661C57A0E8962ABB7E5A607A269616345E99AE8E3B950801F51FCE914597BA1D8D66DC4C0F7A186C62DCB6E1C77AF15F1F7C64D17C2BAB49A7456D36A1771E56531305446EEBB8E72477C0A718DCA38DD3BE2BAF8BA6BBB4B6D1E4B64484BBCED3EE0B920018DA39393F91AE4F51BB02EA4F7AC66BDFB1BD35689CDDF5D67760F4AC24779EF319F9579AD22B41C990DD4DB58AE79A8A390C4EB2A11BD7A1357D09BEA5BB6D6A55908980E9F785696876AFAEEB505947BBF7EC37B0FE14072CDF90FCC8A4A361CEADE3A9EF3142891AA46BB51400AA3B01D055A44F6ACCE42CC6BEB57235A00BF10ABB1B014202D24B53ACD8A044CB72314E1719A40482E0F4CD3C5C1079A003CFF0098F34C7B838F6A4AC054966C8CD66CF30DF17FBFFD0D5203FFD4F797D3E24B3C6074AF3DF10E9C8C5F02B1299E777FA76C90902B29A0C1E45488688A9E22F4A009521C9AD1B5B6CB0C8A4074FA75A80578AECB4D50817DA8B8CE96DEE36AF5AB66FB1B7E6FE2140C98EA191D6A17BDDDDE901E6BF15BC74DE13F0AE2C6509AAEA04C56E7BC6BFC720FA7007B9F6AF902F209354BDB78A339926936EF63C0CF524D6D1568DCB4B43D2B4BB5B5D034216767C976DF2C84732363A9FE83B5737AA5CE24639AE383E6936CE9B72AB2312E251226E53D7AE2A8C7218A572BDC75AE8466D949A133C859988E69925BBA728E0FB11557E84A16389C866240DA2BDABE1F78664D1B4E3797E856FAF17EEB0E523E0807D093C91EC294F44673D8EF952A745AC8CCB118F5AB49C77A00B2A7156233CF5A62270C06326A4120C75A40234983D7F1A167E40268E80585932339A7F99CF5A4038C98E6A3327CA68405592E1514EE603F1AE7B53D7AC2CD375C5E4084303CB815482C7FFFD5F7692FC3458CD725AB37984FBD62CA38ABF80331E2B027B6C13C5431153CBC014E58FB6290CB3142735AD690FCC0D023A1B20062B7ADA4DB8A065F5BAC2819A47BDC3C632796A0651BEF14E99A6A66F6FE088F652E0B1FA28E4FE55C96A5F13CACBE568D6493311F2C97336DCFD2340D21FC40A76B8EDDCF9DFC49E22BDF136A92DFEAB70659DB200ED1AE490AA3B0158714AD14C1D0F2A735D1CBA58D0E8D355F3A3072707AE4D65DFC9E664935CB18F2B3572B98124CF14BF29C8F435224E8E79E0F706B468CAE46E46E3B5B151104BE","payloadType":"str","repeat":"","crontab":"","once":false,"x":106.00004577636719,"y":350.33335876464844,"wires":[["42da0616.473c88"]]},{"id":"b970d3e1.138538","type":"inject","z":"deb0d57.1c46528","name":"ImageMiddle","topic":"","payload":"33926988F4EF863E1EB7BD967D4EE8A486D240914479C3E33B88FA1E3DF27B0AF59643E6A67DEB39BD4CDEE4EABC74A9941A92499462A65E050048A727AD5957DAB9A0437CD34A66C77A2C02ADC0CE18D23DCC71F2F22A8F738A00A571E2AD22C54FDA7518131DB7826B0AF7E2A6816C4886696E18768909A7663B18377F17E57C8D374991BD0CAD8AC4BAF1FF008B6FF22DD21B553FDD5C9A6A296E1A18D3FF00C247A97FC7EEA97041EA15B03F4A853C2BE61DD70EEEDDCB126AAFD80FFFD6F451A912319AA975721C1E6B028C2B9C1635913A641E2A588A6F17B522C633D2A6C05A863E95A96E98C74A605D9351B4D3A357BEB986052700CAE173F9D61EB1F13749D2E002C09BFB83D162F9507D58FF004CD38C5B2945B3062F8D2A884DE69601078114F9FD48AE27C43F1575CD62665B575B2B6ED1C6031FC491CD6B1A5AEA5A8A4735FF00095EA889F25D00C0603AC48AC3E840C8ACFB9F106AF3AB89753BE757FBC1AE1C83F866AF912E82933296E1110073C9A77DAA28D3739C01DEA8498B69AA4534ACB131DC06791D6AC34ECDC76358CE3ADCD148A13F0FC8AA524BCF029AD7416C426E18753508D41CBE1001E84D5A8A3372B1D8781FC652786A6B866DCF0CA54CB18C73CE3773E99AF75B0F1768FA8416F34774A37E4E0A9E38E6B3AB077BA12D51D244E92C61E365753D083915381E958089071DEA192F2DA0199A78D07FB4E0501633A5F1568F6DFEB3508323B2B67F95665D7C44D2222444F24A7FD8434D26C2C64CFF0012C37167A7CAE7B1638ACF9BC77AEDC716D671C59F5C9A7CA0527D5FC4D7A7E6BB3183D9062ABBE91A95E8FF004BBC9DF3EAE69E81718DE1BB3B3B769EF5D5224FBCF23600FC4D6959E8963244B241E5C91B0C8652083436C46926990463841F95482DE341F2A8A56430DA07414BB09E8BD2988FFFD7DF5B9E7AD3DA7C8EB5CE32B48F915466E54D20202B9A558F91480B31263B566F893C5761E14B18E5BCDD24F364416E9F79F1D4FB0F7A126DD80F11D73C4D71AD5F3DF5EE3CE750A00E02A8E807B5604DA9C8DC06C0F415D49591A5FA22B9BD27866CD21BE4C73D6993705BD8C9E4629DE7C2FC06A00A9711097EE1C9ED542F4B9B68C376383EF4EE4B2A4333C2D95079AD183589D5C79AC651DC3F5FCEA64AE1197297E6963BA4125BB7CA7A8EE2AA181D8E38C5649DB4357AEC54B9408400C3DEA00F02A81B0EE1EA6B549D8CA5B8D8E42662FD015208ADFD17C4173A6A3C51CDB11FD541C7E62A9ABA145D8ECFC3FE3FD4B4D9E488DDACB1CDD1A6F9829F5AEC62D7B5FD4D58DBEA716D1D7C951C573CE096A8B60DA6EB375FF1F3A9DD303E8E45463C23E61CCF24B213D77B1359DEC4DD9661F09DAC67EE0CFBD5E4D02D93A20E3DA95D813AE996E9D107E5532DAC4A385140122C2B9E16A6F2F0385A2E239BF1CDBB1F016AEC57848D5BF275AF32D2752BDD336C96170C80804C6DCA9FC2B58ABC44D9E91E1BF14C7ACCDF64BB84C37610B641CA301D71F9D758B6AADD306B369A6324FB2A81CD3BC845ED4AC07FFFD0B6B729FDF1F9D3FED51E3FD627E62B9C686B5E440732A7E2C2AA4D7B6FB4933C5FF7D0A4047FDA16607CD7508FAB8A51ABE9CBF7AF6DC7FDB41482CC7FFC241A4C632FA85B0FAC82BC7BE22EA31DDF8CEE258E6F31218A38633D9401938FF8131AD296E34ADB9C85ADA7F68F9AEF776F6D144406799F04939202A8C96E9DAAEC7A1D8381B24D4AF49EF6D68517FEFA6AD652B31971747B18705B4B9303BDDEA091FE8A33527D8F445E648F458F1FDED42693F451509B6220921D117FD44FA229C77174FF00CD6ABB4D696DCC3A8696983D61B0763FF8F0A6AF7B0DC460F13C90A951ACDE6DC74B6B748AAA5DF896D6E632B74754BA6EC66B918FE54D45F4423066BD85C9D914AA3DE6CFF4AA73189C8D81C377DC41FE9569344BB3238E792DDF72311EB5ACBA8092DB2A31274C52946E5465D0A6F72896DE5E4BBB39DD90318C76F7EB4B0BDB3C80333A7A6F0197F1EF8A64F52FFF0066466D83C2E8A09C12CC0A1FA376FA1C564CA8D0CCC92750714260D5868908E4122B734ED5A4484AB48C194763D453E838BB33B1D07C757BA6DB1465173193F2C723608FA1FE95D45AFC4ED365216F2D6E6DDBB900381FD7F4AE79D3D6E86CE9F4AD7B4BD6E5F2F4EBD8E49769731E08600632707EA2B752D4B75358B4D6E21E2C453C58A8EA45021E2D5052F9099A00C2F1AC51B78035F5039FB1487F219FE95E0F6928FB144C0F551FCAB7A7B099AFA05E341E20B7707D41AF5E86EFE40CA782294C11652F013C9C1A93CECF43598CFFD1F2F7974D4D4ED2D4A4EFF6A892547121E8D9EDF853F5E161A3E942EDA29241E6052A253DEB049E882E61D86AB65AE6A096BA45AA2B889A494DECFB146080029EE7935D045E15D564884A3C371CD1B0CABC376A430F51915BC684E4AE8CE756317663DF4196009E6F856F8E473B0A360FA75ACED5E5B1D0F4D37575E1DBD882C8A9FBE5555C9CF704F3C543A3340AB41BB5C834CF1269BA8DFD9C7A658ADBBC8E62692750C2376188D87A80D8CFB5735E2D80C1ADC9731AB7D9F50CDC264FDC624F9919F757DCB8FA5382E5364625A6A973A5CAEF6720495D7697DA091CE7827A1F7155EE758D42E0913DE5C38F4321C7E554E29BBB06EC512C4F53C9E69849ABD890F358639A78B961814ADDC2E2FDA011CA8A0B2376A0644CA33D45336FBD02B0D6C63A0A566F2A308BD4F24D1B888BDA9CBD7FC68B858B105CCD6EC5A09191BB953D6B552F6DAFA154D4234F340C09492A0FD71C8FD7E952D752BC86B5B5A3C655160661CE2198EEFF00C7860D2C1A7C4E0848E7471FC4195FF41CD1CCC5627BBB53A7DA40FE639F31F00342C8318EC4F5A6F9EB32890019EE29EE86D1D57802EA387C58AD2BA4686DE41B99B03B1EBF857AA8F176956876CFA95B0FFB6A09AC26AEC4915E7F897E1DB6FBD7E243E91A337F4AC6BFF8C5A4C29FE836D7170C7FBD84150A9BEA3B239BBDF8BF7B3C216DED561723E621B38FA7158B37C4DF104A488E65894F6033FAD68A925B8AE63DE78BF5DBD4B85B8BE90A5C214917B153D46292CDBFD062FF0076B4568A13D59734F9BCBD5EDBFDEFE95EB1A5DD79B68013CAD4480D0DD4E594A9E0D401FFD2F23B97D2ED23D2F57BB9A5CDADBC56FF0020DC81803F7BD3926B17C55E25B0D57408E0827DF28937901703A1C7F3AC6376D1538F2BB339BF0B907509CFFD32FEA2BEB2F0B5B6EF086883730FF428B853EA33FD6BD4C3AF74E0AEECCDB5B1DA49491C1EDCE6BC7BF681F322F0BE8706F66F36F64240E338418E3BF5AD6AAB4198D3779A3C62DE1FB1E9F1459C49212EC54F4EC3F2C575F7257C55E1C99A2D8B773B9942E71B6F40F9D47A09A31B87FB486BCC92EA7ABB2B1E6AED97C904107041E08FAD31C7CDF5AA10CFE7487DE8106051B477A69009B7F2A695C8E0D20131CD201C8C51601AE702897FD6E69D84215C723B52E4114863B3923DE9CBF5A56009381C5428E51810483F5A76116249E4936F98ECD8E7E639ADCD374ECC24DD0C492711C65C26D041F9DC9E801C7D693B21EE63D9DBDCDEDEF9110677E781C74EF5AA3C3D7C71B902FD5C54B7612D4993C3731FF59344BEBCE6AEC1E16596409E79663C6D8D33537D00D88BC110A461E69085070773018A964D034BB390A1224DBF78F240ED51CF72F95915D58DA2412450A420B82AAC571D7A735891E99736B0889D43320E76366AAFA58971204DF0EA706F52A438C82315E93A35CEC93693C1A1AD04747BA9775401FFD3F9AAFF0050BCD3741BBB2942B437584F9C67F11F975AE53C99A19079B1BA77F9811446C826EECE8FC2E717174D9E91019FC6BEBFF0DBEDF0B68AA983B6C6004023AEC15E8E1ADCA70623737519F667675AF25F8E767F6BD1B4B9A375F334F125C184FDE60CD1C7B80F419CD6988B2A6D995057A88F05B86F2E5C7658F14CD2B538ED12EE1BA577B5BB40AFB0E19181CA48BFED29FD091DEBCB68F5CB3A95849A940D711ED7BF09E6318C7CB7718FF968BFED0FE25FC6B98762C14F6A16A48D34EC1F4AAD8439627738442C7D00CD5C8746D4AE71F67B0B971D888891FCAA5B4B702CFF00C231AB632F68538FF968EA9FCCD21F0E5D2FFAE9ECA2EBF7EE57FA66973A1D98A9A043D67D5F4F4C7656673F905AB7FF0008FD92C5B85DDECFC6730D83EDFCC9A4E7E41630752B35B575D82611B6483347B09FF3C55A7D362671FB8BD24A8C8D80738E79ABBE82EA5A8F488E4578C58DE8931F2E5D01CE3D0D662E933BE441245291C15571B87D41A9B858866B2B9B63FBF85D07A9538FCEA0563BBFC29AB3015F907D2A23D6A908D4D3554069C940C8701A41954F7F73E828BCD444D198A107CB2E19A46E5E423B93FD3B54BDC7B1269970D65AE6F5009D8D807DD6B4A6D7672DC28149AD4488A2D42EEE678E259029918283D866BB585E3D2E259313E13397C0CC9EFCF4ACE6BA17120BBD71DD0C5196D921C8627A7B11555AE926462768C1EB927231D2A52B22BA99D34CCA59C36541E109383508BC7597703B8B0F5395AA489B9622BC13CABF688C39272739257DC5749A6DDA3B8313671D7DA8B0A5DCEC2297CC894FB54A1EA0947FFFD4F94229DB50B5FB2DC367CBF9918F6F6AF41D7A6B197C3FAD4D05F095A5846C859810A772F4E339A89C5DD24166D5D1C5F8724891EE0CF2AC21D0056604827D38FAD7D1FA478FF423A5585B25EA868ADE38DB31F755038E3DABD0A13515667255A739BD11B6DE2FD2EDF4DB8BCFB64722C11B49E58182F8FE10477278FC6BCB2D35D7F1458EA179A94C82EE18F528E3DCD91223DB870832780AD1AE3F0EE69E214AA24A09B1E1E9BA6DB9AB1E537B700CE0020E5477CF6ACD0FF230E2B92C76366A68FACADADACB657618DB48DB9244FBF6F20E8E87F423B8AD78F4D875199A592D8DCCCC158BC13243138E00383CE4F71EB50D35AA04AFB17C6936968031B4D190800FFA45EBC87F10BC533EDF6565855BED26265FF9F6D3CC87F36ACF729C5ADD11B7896D901FF89AEA721C7FCB08638455297C416073BA2D4EE4E3A4F7A40FC94557B36FA0AEBB945F5CB4CE63D1EDB3EB2C8F213F99A8D75F74CF95A7E9A9E98B707F9E69FB362BA1FF00F094EA8BFEA268E107FE78C28BFC8552B8D6B52BA63E7DFDCB96EA0CA71F9552A690B9BB19D34D24CDB6576703FBCC4E298F75337595F19E858F14EC89BB1A24667E49FAD5B4D402B289EDE19940032CB86C7D452E5E887CDDCBB16A96E06145CDB9FF00624DEBF91A995E1B83C3D9CE73D248CC4DF98A9B587B91DD59DB26D32C6F6C5BA32B8953F4E45645CDBB5BCBB58860790CA7208AA8A7D44F42332BBA2C658EC5E83B52672C0555857341081A945E9B481FAD4EE06EEA2A64810A92FD9DD250395606BA596FCCB3BC9334830A1","payloadType":"str","repeat":"","crontab":"","once":false,"x":96.00004577636719,"y":387.33335876464844,"wires":[["42da0616.473c88"]]},{"id":"a00bd9e3.7c3a28","type":"inject","z":"deb0d57.1c46528","name":"ImageEnd","topic":"","payload":"412C1803EF59CA0DEA5C5EB62BA5E3CE4FDA1B71507952338A6C7708214209F29B248C8A3958D8CB87531205279391C8ACF123962D9F9B20751F953E5EE224F3972D821581033BAAFD86A5F6794C830180C15A5CAC0F45D3AFA192DD4F9B1805770CB0E957C5CC27A4B1FD378A97097625465D8FFFFFFFFD9","payloadType":"str","repeat":"","crontab":"","once":false,"x":105.00004577636719,"y":424.33335876464844,"wires":[["42da0616.473c88"]]},{"id":"cfc97596.bbdfc8","type":"inject","z":"deb0d57.1c46528","name":"ImageTerm","topic":"","payload":"KFM","payloadType":"str","repeat":"","crontab":"","once":false,"x":104.00004577636719,"y":461.33335876464844,"wires":[["42da0616.473c88"]]},{"id":"40df9be0.ea9ac4","type":"function","z":"deb0d57.1c46528","name":"stringInBuffer","func":"// With the entire file stored as a string in the msg.payload\n// convert the string to a hex buffer and return that buffer as\n// the new msg, only when the full image is available\nvar isFullImage = global.get(\"finished\");\nif(isFullImage){\n    var buf = Buffer.from(msg.payload, 'hex');\n    msg.payload = buf;\n    global.set(\"finished\", false);\n    return msg;\n}\n","outputs":1,"noerr":0,"x":534.0000457763672,"y":348.33335876464844,"wires":[["7e7c5dd.6f2a024","53d7a99a.6da7a"]]},{"id":"b5459102.b25d78","type":"debug","z":"deb0d57.1c46528","name":"","active":false,"console":"false","complete":"payload","x":421.0000457763672,"y":400.33335876464844,"wires":[]},{"id":"5dbd96e9.dfe5a","type":"template","z":"deb0d57.1c46528","name":"displaySuccessfulUpload","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<html>\n<head>\n<meta charset=\"UTF-8\">\n<title>Uploaded File</title>\n</head>\n<body>\n    <H2>Successfully uploaded at {{payload.time_stamp_string}} {{payload.file}}</H2>\n    <p><a href=\"https://smart-doorbell-kfm.mybluemix.net/\">Click here to go back</a></p>\n</body>\n\n</html>","output":"str","x":940.678539276123,"y":1758.5713968276978,"wires":[["65614fc.6cee23"]]},{"id":"d7536093.39c8b8","type":"debug","z":"deb0d57.1c46528","name":"","active":false,"console":"false","complete":"false","x":791.5,"y":61,"wires":[]},{"id":"3f60bc46.04da54","type":"http request","z":"deb0d57.1c46528","name":"","method":"use","ret":"obj","url":"","tls":"","x":484.5,"y":162,"wires":[["212727ca.bf10a","97047a57.df6ec8"]]},{"id":"97047a57.df6ec8","type":"debug","z":"deb0d57.1c46528","name":"","active":false,"console":"false","complete":"false","x":586.5,"y":62,"wires":[]},{"id":"6e7232ab.954354","type":"http in","z":"deb0d57.1c46528","name":"","url":"/faces","method":"get","upload":false,"swaggerDoc":"","x":67.0000114440918,"y":1655.3332662582397,"wires":[["a34b9a89.64e05"]]},{"id":"a34b9a89.64e05","type":"function","z":"deb0d57.1c46528","name":"setQueryPayload","func":"// Set the msg to query the database containing the images \n// either uploaded from the Smart doorbell or the upload \n// button on the website\nmsg.url = \"https://f5b8c6ed-103b-4151-b029-70a10968cc4b-bluemix.cloudant.com/images/_find\";\nmsg.headers = {\n    \"Content-type\" : \"application/json\"\n};\nmsg.method = \"POST\";\nmsg.payload = {\n   \"selector\": {\n      \"time_stamp_nano\": {\n         \"$gt\": null\n      }\n   },\n   \"fields\": [\n      \"imageData\",\n      \"time_stamp_nano\"\n   ],\n   \"sort\": [\n      {\n         \"time_stamp_nano\": \"desc\"\n      }\n   ],\n   \"limit\": 1\n};\nreturn msg;","outputs":1,"noerr":0,"x":245.0000114440918,"y":1654.3332662582397,"wires":[["8214ba4b.aa1618"]]},{"id":"8214ba4b.aa1618","type":"http request","z":"deb0d57.1c46528","name":"","method":"use","ret":"obj","url":"","tls":"","x":436.0000114440918,"y":1655.3332662582397,"wires":[["14bd70e1.6d4b07"]]},{"id":"14bd70e1.6d4b07","type":"function","z":"deb0d57.1c46528","name":"setString","func":"//EST\noffset = -5.0;\nEST_date = new Date(msg.payload.docs[0].time_stamp_nano + (3600000*offset));\nflow.set(\"time\",EST_date.toLocaleString());\nmsg.payload = msg.payload.docs[0].imageData.substr(23);\nreturn msg;","outputs":1,"noerr":0,"x":590.0000114440918,"y":1654.3332662582397,"wires":[["a4e6a251.066f1"]]},{"id":"3bd669f1.d1d826","type":"debug","z":"deb0d57.1c46528","name":"","active":false,"console":"false","complete":"false","x":772.0000114440918,"y":1590.3332662582397,"wires":[]},{"id":"d6e4a3e4.53b9c8","type":"visual-recognition-v3","z":"deb0d57.1c46528","name":"","apikey":"","image-feature":"detectFaces","lang":"","x":1214.0000114440918,"y":1652.3332662582397,"wires":[["95ac072b.08af3","c5047a0.4b63a08"]]},{"id":"95ac072b.08af3","type":"debug","z":"deb0d57.1c46528","name":"","active":false,"console":"false","complete":"result","x":1318.0000114440918,"y":1591.3332662582397,"wires":[]},{"id":"c5047a0.4b63a08","type":"function","z":"deb0d57.1c46528","name":"isFaceThere","func":"if(msg.result.images[0].faces.length > 0){\n    msg.payload = \"Face Detected\";\n    msg.faceDetected = true;\n} else {\n    msg.payload = \"No Face Detected\";\n    msg.faceDetected = false;\n}\nreturn msg;","outputs":1,"noerr":0,"x":1394.5000114440918,"y":1649.3332662582397,"wires":[["cbac9198.814d98","1b3b6e.a00a5c92"]]},{"id":"1b3b6e.a00a5c92","type":"template","z":"deb0d57.1c46528","name":"Webpage Template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n    <head>\n    </head>\n    <body>\n        <h1>Smart Doorbell</h1>\n        </br>\n        <h2>{{payload}}</h2>\n        <p><a href=\"https://smart-doorbell-kfm.mybluemix.net/\">Click here to go back</a></p>\n    </body>\n</html>","output":"str","x":1658.0000381469727,"y":1548.8332691192627,"wires":[["a4ec869.e324978"]]},{"id":"a4ec869.e324978","type":"http response","z":"deb0d57.1c46528","name":"","statusCode":"","headers":{},"x":1834.0000381469727,"y":1549.8332691192627,"wires":[]},{"id":"cbac9198.814d98","type":"function","z":"deb0d57.1c46528","name":"setPayload","func":"if(msg.faceDetected) {\n    msg.payload = \"Someone is at the door\\n\" + flow.get(\"time\") + \"\\n\";\n    msg.topic = \"Face Detected\";\n    msg.attachments = {\n        filename: \"smart_doorbell.jpg\",\n        content: flow.get(\"img\"),\n        encoding: \"jpeg\"\n    };\n    return msg;\n} else {\n    return null;\n}\n","outputs":1,"noerr":0,"x":1603.0000381469727,"y":1593.3332719802856,"wires":[["7e8716a5.8f30b","d5b746b5.60e63"]]},{"id":"7e8716a5.8f30b","type":"e-mail","z":"deb0d57.1c46528","server":"smtp.gmail.com","port":"465","secure":true,"name":"kwm19@pitt.edu","dname":"Email notification","x":1824.00004196167,"y":1601.3332710266113,"wires":[]},{"id":"7f3f5420.990f9c","type":"inject","z":"deb0d57.1c46528","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":216.5000400543213,"y":698.0833606719971,"wires":[["4fbf4ee7.ca3cb8"]]},{"id":"4fbf4ee7.ca3cb8","type":"function","z":"deb0d57.1c46528","name":"MakeCSS","func":"var css = '<style>';\ncss += 'body,h1,h2,h3,h4,h5 {font-family: \"Futura\", sans-serif}';\ncss += 'body {font-size:16px;}';\ncss += '.center {';\ncss += 'margin: auto;';\ncss += ' width: 70%;';\ncss += 'border: 3px solid #73AD21;';\ncss += 'padding: 10px;';\ncss += '}';\ncss += 'table {';\ncss += 'border-collapse: collapse;';\ncss += 'width: 60%;';\ncss += '}';\ncss += 'th, td {';\ncss += 'text-align: center;';\ncss += 'padding: 8px;';\ncss += '}';\ncss += 'tr:nth-child(even){background-color: #f2f2f2}';\ncss += 'th {';\ncss += 'background-color: #4CAF50;';\ncss += 'color: white;';\ncss += '}';\ncss += 'body {';\ncss += 'background-color: lightblue;';\ncss += '}';\ncss += 'div {';\ncss += 'background-color: white;';\ncss += '}';\ncss += '</style>';\nglobal.set(\"css\", css);\n\n    \n   \n\n   \n    \n\n\n    \n    \n\n\n\n    \n    \n\n    \n","outputs":1,"noerr":0,"x":413.5000400543213,"y":697.0833606719971,"wires":[[]]},{"id":"2a87870c.85a778","type":"comment","z":"deb0d57.1c46528","name":"Create CSS","info":"This workflow simply creates an HTML style tag string to beautify the webpage\n* stored globally ","x":103.50004005432129,"y":651.0833606719971,"wires":[]},{"id":"a4e6a251.066f1","type":"base64","z":"deb0d57.1c46528","name":"","x":728.5000114440918,"y":1653.3332662582397,"wires":[["3bd669f1.d1d826","7da122d1.5a61ec"]]},{"id":"5ac6ed7c.9474b4","type":"file-buffer","z":"deb0d57.1c46528","name":"","mode":"asBuffer","x":496.5,"y":1796.5,"wires":[["9d36dd8a.1d7fb"]]},{"id":"769f0360.b2de4c","type":"httpInMultipart","z":"deb0d57.1c46528","name":"","url":"/upload_deprecated","method":"post","fields":"[ { \"name\": \"myUploadedFile\"} ]","swaggerDoc":"","x":124.5,"y":1797.5,"wires":[["bd8da248.da6828"]]},{"id":"d5b746b5.60e63","type":"debug","z":"deb0d57.1c46528","name":"","active":false,"console":"false","complete":"true","x":1830.5000381469727,"y":1658.3332734107971,"wires":[]},{"id":"7da122d1.5a61ec","type":"function","z":"deb0d57.1c46528","name":"saveBinaryToFlow","func":"flow.set(\"img\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":980.5000114440918,"y":1656.3332662582397,"wires":[["d6e4a3e4.53b9c8"]]},{"id":"e1fce464.660728","type":"visual-recognition-v3","z":"deb0d57.1c46528","name":"","apikey":"","image-feature":"detectFaces","lang":"","x":1003.9643516540527,"y":406.44046211242676,"wires":[["9e4ad2c0.00d19","b9ef15fb.cefac8","425a1a80.98fc3c"]]},{"id":"9e4ad2c0.00d19","type":"function","z":"deb0d57.1c46528","name":"isFaceThere","func":"// construct html for email and webpage for whether or not a face \n// is detected by visual recognition. Will only send an email if a \n// face is present\nif(msg.result.images[0].faces.length > 0){\n    var j = 0;\n    var html = '<!DOCTYPE html>' +\n'<html>' +\n    '<head>' +\n    global.get(\"css\") +\n    '</head>' +\n    '<body>' +\n        '<div class=\"center\">'+\n        '<h1 align=\"center\">Smart Doorbell</h1>'+\n        '<h2 align=\"center\">By: KFM Industries</h2>'+\n        '<h3 align=\"center\">Jon Kenneson, Alexander Furches, & Kyle Monto</h3>'+\n        '<h3 align=\"center\">Motion Detected and image taken</br> Face details below, see attachment for image.</h3>';\n    for(j = 0; j < msg.result.images[0].faces.length; j++){\n        var face = '<p align=\"center\">Face ' + (j+1) + ':</br>Age: between ' + msg.result.images[0].faces[j].age.min + \n        ' and ' + msg.result.images[0].faces[j].age.max + ' with confidence of ' + msg.result.images[0].faces[j].age.score + \n        '</br>Gender: ' + msg.result.images[0].faces[j].gender.gender + ' with confidence of ' + msg.result.images[0].faces[j].gender.score + '</p>';\n        html = html + face;\n    }\n    \n    html = html + '<p align=\"center\"><a href=\"https://smart-doorbell-kfm.mybluemix.net/\">Click here to go webpage</a></p></div></body></html>';\n    msg.payload = html;\n    msg.faceDetected = true;\n} else {\n    var html = '<!DOCTYPE html>' +\n'<html>' +\n    '<head>' +\n    global.get(\"css\") +\n    '</head>' +\n    '<body>' +\n    '<div class=\"center\">'+\n    '<h1 align=\"center\">Smart Doorbell</h1>'+\n    '<h2 align=\"center\">By: KFM Industries</h2>'+\n    '<h3 align=\"center\">Jon Kenneson, Alexander Furches, & Kyle Monto</h3>'+\n    '<h3 align=\"center\">Motion Detected and image taken</br> No face detected</h3>';\n    html = html + '<p align=\"center\"><a href=\"https://smart-doorbell-kfm.mybluemix.net/\">Click here to go webpage</a></p></div></body></html>';\n    msg.payload = html;\n    msg.faceDetected = false;\n}\nreturn msg;","outputs":1,"noerr":0,"x":1212.7499923706055,"y":471.61901092529297,"wires":[["15b3fffd.95c188","974e331e.dedc2","63ed0467.c142b4"]]},{"id":"5ecb4f9e.25ce1","type":"httpInMultipart","z":"deb0d57.1c46528","name":"","url":"/upload","method":"post","fields":"[ { \"name\": \"myUploadedFile\"} ]","swaggerDoc":"","x":138.47225952148438,"y":545.5555906295776,"wires":[["c66b101c.55121"]]},{"id":"c66b101c.55121","type":"function","z":"deb0d57.1c46528","name":"setPathForBuffer","func":"// set path for buffer - comes from file selector in on the webpage\nvar files = Object.keys(msg.req.files);\nmsg.payload = msg.req.files[files[0]][0].path;\nreturn msg;","outputs":1,"noerr":0,"x":337.2500343322754,"y":544.333345413208,"wires":[["a2f16ed0.0a05b8"]]},{"id":"a2f16ed0.0a05b8","type":"file-buffer","z":"deb0d57.1c46528","name":"","mode":"asBuffer","x":538.2500343322754,"y":542.333345413208,"wires":[["53d7a99a.6da7a","b0f8a5f5.13a698"]]},{"id":"63ed0467.c142b4","type":"http response","z":"deb0d57.1c46528","name":"","statusCode":"","headers":{},"x":1375.2659797668457,"y":428.8174743652344,"wires":[]},{"id":"15b3fffd.95c188","type":"function","z":"deb0d57.1c46528","name":"setPayload","func":"if(msg.faceDetected) {\n    msg.payload = msg.payload;\n    // msg.payload = \"Someone is at the door\\n\" + flow.get(\"time\") + \"\\n\";\n    msg.topic = \"Smart Doorbell - KFM Industries\";\n    msg.attachments = {\n        filename: \"smart_doorbell.jpg\",\n        content: flow.get(\"img\"),\n        encoding: \"jpeg\"\n    };\n    return msg;\n} else {\n    return null;\n}\n","outputs":1,"noerr":0,"x":1399.1666793823242,"y":530.0556077957153,"wires":[["b3a1908f.9b36e"]]},{"id":"b3a1908f.9b36e","type":"e-mail","z":"deb0d57.1c46528","server":"smtp.gmail.com","port":"465","secure":true,"name":"kwm19@pitt.edu","dname":"Email notification","x":1599.7499389648438,"y":530.5555839538574,"wires":[]},{"id":"974e331e.dedc2","type":"debug","z":"deb0d57.1c46528","name":"isFaceThereDebug","active":true,"console":"false","complete":"true","x":1340.1388549804688,"y":582.4167156219482,"wires":[]},{"id":"53d7a99a.6da7a","type":"function","z":"deb0d57.1c46528","name":"saveBinaryToFlow","func":"// save the image to a flow context for use when sending email\n// if face is detected\nflow.set(\"img\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":756.2500419616699,"y":414.5833568572998,"wires":[["e1fce464.660728"]]},{"id":"b0f8a5f5.13a698","type":"function","z":"deb0d57.1c46528","name":"createImagePayload","func":"// Convert the hex binary buffer to a base 64 image\n// and construct the remaining fields that will eventually end up in the \n// database\nvar files = msg.req.files;\nfilename = files.myUploadedFile[0].originalname;\nvar mime_type = files.myUploadedFile[0].mimetype;\nvar data = Buffer.from(msg.payload).toString('base64');\nvar dt = new Date();\nvar utcDate = dt.toUTCString();\nvar imageDataString = 'data:'+ mime_type +';base64,'+ data +'';\nvar jsobObject = { \n\"time_stamp_string\": utcDate,\n\"time_stamp_nano\": dt.getTime(),\n\"imageData\": imageDataString\n};\nmsg.topic = \"ImageData\";\nmsg.payload = jsobObject;\nmsg.file = filename;\nreturn msg;\n\n\n","outputs":1,"noerr":0,"x":756.2500343322754,"y":543.333345413208,"wires":[["ea368a98.9423d8","63d3cc7.f413f34"]]},{"id":"8710afc4.08646","type":"comment","z":"deb0d57.1c46528","name":"connect to HexToBase64","info":"","x":421.85716247558594,"y":1755.0356454849243,"wires":[]},{"id":"24e5d648.ee6982","type":"comment","z":"deb0d57.1c46528","name":"connectToImages","info":"","x":895.0000038146973,"y":1823.9999961853027,"wires":[]},{"id":"a4ceeed8.92acf8","type":"comment","z":"deb0d57.1c46528","name":"Deprecated Flows","info":"","x":108.35821533203125,"y":1721.95849609375,"wires":[]},{"id":"63d3cc7.f413f34","type":"function","z":"deb0d57.1c46528","name":"joinFaceAndImageData","func":"// join the data from the visual recognition node together with the\n// image data\ncontext.data = context.data || {};\n\nswitch (msg.topic) {\n    case \"ImageData\":\n        context.data.imageData = msg.payload;\n        msg = null;\n        break;\n    case \"FaceData\":\n        context.data.faceData = msg.payload.images[0].faces;\n        msg = null;\n        break;\n    default:\n        msg = null;\n    \tbreak;\n\n}\n\nif(context.data.imageData != null && context.data.faceData != null ) {\n// \tvar faces = \"No Faces Detected\";\n// \tif(context.data.faceData.images[0].faces.length > 0){\n//         // var numFaces = msg.result.images[0].faces.length;\n//         faces = context.data.faceData.images[0].faces;\n//     }\n// \tvar jsonObject = { \n//         \"time_stamp_string\": context.data.imageData.time_stamp_string,\n//         \"time_stamp_nano\": context.data.imageData.time_stamp_nano,\n//         \"imageData\": context.data.imageData.imageData,\n//         \"faces\": faces\n//         };\n// \tmsg = jsonObject;\n//     context.data=null;\n    msg = context.data;\n    context.data=null;\n\treturn msg;\n} else {\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":1340.1586151123047,"y":260.3174419403076,"wires":[["d4b50727.1c5cd","7eb35d6d.41a594"]]},{"id":"b9ef15fb.cefac8","type":"debug","z":"deb0d57.1c46528","name":"visRecResultDebug","active":false,"console":"false","complete":"result","x":1080.4760971069336,"y":533.6507911682129,"wires":[]},{"id":"ea368a98.9423d8","type":"debug","z":"deb0d57.1c46528","name":"createImagePayloadDebug","active":false,"console":"false","complete":"true","x":1037.1429481506348,"y":604.7619204521179,"wires":[]},{"id":"d4b50727.1c5cd","type":"debug","z":"deb0d57.1c46528","name":"joinDebug","active":false,"console":"false","complete":"true","x":1541.58726644516,"y":310.00007343292236,"wires":[]},{"id":"425a1a80.98fc3c","type":"function","z":"deb0d57.1c46528","name":"setMessageForVisRec","func":"// parse the msg to be returned for the joining of data\nmsg.topic = \"FaceData\";\nmsg.payload = msg.result;\nreturn msg;","outputs":1,"noerr":0,"x":1231.2698211669922,"y":360.1588020324707,"wires":[["63d3cc7.f413f34","92e6f1a2.8415d8"]]},{"id":"92e6f1a2.8415d8","type":"debug","z":"deb0d57.1c46528","name":"setMessageForVisRecDebug","active":false,"console":"false","complete":"true","x":1500.1587142944336,"y":362.06351947784424,"wires":[]},{"id":"ee167c83.ed53f","type":"debug","z":"deb0d57.1c46528","name":"hexToBase64Debug","active":false,"console":"false","complete":"true","x":961.3491821289062,"y":239.68254470825195,"wires":[]},{"id":"7eb35d6d.41a594","type":"function","z":"deb0d57.1c46528","name":"prepForDB","func":"// reorganize payload for storage in the DB\nvar faces = \"No Faces Detected\";\nif(msg.faceData.length > 0){\n    faces = msg.faceData;\n}\nvar jsonObject = { \n\"time_stamp_string\": msg.imageData.time_stamp_string,\n\"time_stamp_nano\": msg.imageData.time_stamp_nano,\n\"imageData\": msg.imageData.imageData,\n\"faces\": faces\n};\nmsg.payload = jsonObject;\nreturn msg;","outputs":1,"noerr":0,"x":1564.4444274902344,"y":260.6349334716797,"wires":[["e12acf0c.487f08","a35d26b0.e3f74"]]},{"id":"e12acf0c.487f08","type":"debug","z":"deb0d57.1c46528","name":"prepForDbDebug","active":false,"console":"false","complete":"payload","x":1766.9842071533203,"y":306.0317611694336,"wires":[]},{"id":"40ffed28.9a1a44","type":"comment","z":"deb0d57.1c46528","name":"Upload image from website","info":"","x":125,"y":606.6666097640991,"wires":[]},{"id":"91f33746.378628","type":"mqtt-broker","z":"","broker":"198.41.30.241","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"willTopic":"","willQos":"2","willRetain":"true","willPayload":"","birthTopic":"","birthQos":"2","birthRetain":"true","birthPayload":""}]
